FBrugia malayi0502Secernentea0501 Spirurida0501Onchocercidae0501Brugia
Meloidogyne hapla0502Secernentea0501Tylenchida0501Heteroderidae0501Meloidogyne
Meloidogyne incognita0502Secernentea0501Tylenchida0501Heteroderidae0501Meloidogyne
Pristionchus pacificus0502Secernentea0501Diplogasterida0501Diplogastridae0501Pristionchus 
Heterorhabditis bacteriophora0502Secernentea0501Rhabditida0501Heterorhabditidae0501Heterorhabditis 
Caenorhabditis elegans0502Secernentea0501Rhabditida0501Rhabditidae0501Caenorhabditis

###Ensembl08070103・040504080203ù06ò×é08050606020106030805090503ò0802050100±05070003060206060700000208020203000504°020300010403030405010803Ensembl0807010303080806080209040805090503ò080204ò09040501060401040603000203ù06ò02030703・0703ò09070703050102050107070903ù06ò0802±à000504ò090406010201Ensembl0004080204ò0904・0703ò03060501###

06050602050904ò0802010000090800030806030704500000502*Caenorhabditis elegans0501Caenorhabditis brenneri0501*Caenorhabditis briggsae0501*Caenorhabditis remanei0501Caenorhabditis japonica0501
10501・00±08040309¨600020207000000040802retrocopy0501・00retrogene0201retropseudogene050108¤050909040105080201070205
20501090801070002020700000802retrogene020109040802000003ù06ò04040900ks010405090503030408±04010501ka/ks0104050909ù080505030809
305010309080109090408retrogene08020101080705é0702050106040104080500±03080101080708020404090004010805・090805080505030809
40501Caenorhabditis elegans0802±í07070805060605¨EST0201mRNA0508×0609à050101053937140001050104010904020700000904070207033500000010305
   05040607retrocopy0803C.elegans00040802±í070705é0702050101030704±í07070805060600§06000802retrocopy070706080701080805é・05・¨05é00¤0401±í07070305
50501×040203C.elegans0004retrocopy0705±í070708050606060804°08°°××é0802±06090805é07020501040309¨chimeric03ù06ò0501050307ó・0902§0203080805é05é00¤0401・00050405é0702060804°0503030405é07020305

==================================================================================================

0400・06020904÷08020809040401ü09060502
bsub -n 4 -q normal -o blast.out -e blast.err "perl ~/yangld/bin/control_process.pl -i bla.sh -c ~/yangld/bin/config.ini"

=========================================================RepeatMasker=============================
mkdir RM
cd RM
cp ../dna .
nohup RepeatMasker -pa 4 -s -species danio dna &            ###0207080208050409±0208000001000704ò0904050106ò02090001000704ò090403ù±060703・05±à00050503###
0606080003ù06ò×é0004MtDNA04ò0904                                        ###06ò0209MtDNA0807080203ù06ò000008à04°0805090709040805010009¨0802050109ù06080503070702050704retrogene###

open(fil,"dna.masked");
while (<fil>) {
  chomp;
  if (/>/) {
    s/>//;
    $name=$_;
  } else {
    $seq{$name} .= $_;
  }
}
while (($key,$value) = each %seq) {
  unless ($key =~ /mtdna/i) {
    print ">$key\n$value\n";
  }
}

perl temp.pl > temp
mv temp dna.masked  (000101ü0104)
rm nohup.out temp.pl dna
=========================================================tblastn ###08°°×04ò09040908020909á07090802±06090805010500070900040802020909á・020605060708°°×04ò09040501060302ó05030404±060908,090905ù07070608080308°°×0903040505030404±060908050107070903080308°°×09030405090606020406030105030201080204ò0904###========================================== 
mkdir blast
cd blast/
cp ../RM/dna.masked ../pep .
05¨0709          formatdb -i dna.masked -p F
・00000608°°×      perl ~/yangliandong/binl/divide_fasta.pl -i pep -od . -f2 -N 4   ###°05M000204ò0904・000607N00020202040605010107000202020406°ü0201M/N000204ò0904###
08090404blast     ls *.seq|awk {'print "blastall -p tblastn -i "$1" -d dna.masked -e 1e-3 -o "$1".bla.out &"'} > bla.sh
              nohup perl ~/yangliandong/bin/control_process.pl -i bla.sh -c ~/bin/config.ini &  
03ò0908 ls *.seq|awk {'print "blastall -p tblastn -i "$1" -d dna.masked -e 1e-3 -o "$1".bla.out &"'} > bla.sh
bsub -n 20 -q high -o blast.out -e blast.err "sh bla.sh"

============================00ù0606ensembl0004030008010802pep080202030001×04080104030304050100á0603pep±à000503ù06ò0802020300010501080200á0603040104ò09040501060302ó×02GeneWise09¨08°°×05á0101======================================================
mkdir pep_genewise
cd pep_genewise
cp ../Gasterosteus_aculeatus.BROADS1.62.pep.all.fa  .
mv Gasterosteus_aculeatus.BROADS1.62.pep.all.fa  pep

00ù0606pep080202030001×04080104030304050100á060308°°×0802±à000503ù06ò080206080002020300010501
open fil,"pep";
while (<fil>) {
   chomp;
   if (/>/) {
      s/>//;
      split; 
      split /:/,$_[2];
      if ($a[5]<1) {
         $a[5]="-";
         print "$_[0]\t$a[2]\t$a[5]\t$a[3]\t\t$a[4]\n";
      } else {
         $a[5]="+";
         print "$_[0]\t$a[2]\t$a[5]\t$a[3]\t\t$a[4]\n";
      }
   }
}

perl temp.pl > pep.dna.pos    ###08070103080508°°×0802±à000503ù06ò0802060800020203000104030304050101050704246610001pep04°04010908070708020203000104030304###

0707RM080203ù06ò×édna080700á060308°°×±à000504ò0904
perl ~/yangliandong/bin/get_fa_from_genome.lixin.pl -p pep.dna.pos -s ../Oryzias_latipes.MEDAKA1.62.dna_rm.toplevel.fa -o pe.dna.pos.seq  

rm temp.pl

09080107000208°°×04°0401±à000503ù06ò×02genewise050106・09¨0107000208°°×0802intron0201exon080205á0101 

#!/usr/bin/perl
#1 pos 2 dna 3 pep
open(dna,"$ARGV[1]");
while(<dna>){
   chomp;
   if(/>/){
   split;
   $name=$_[0];
   $name=~s/>//;
  }else{
   $dnaseq{$name}.=$_;}
 }
open(pep,"$ARGV[2]");
while(<pep>){
   chomp;
   if(/>/){
   split;
   $name=$_[0];
   $name=~s/>//;
   }else{
   $pepseq{$name}.=$_;}
 }
open(wise,">>$ARGV[0].wis");
open(T,"$ARGV[0]");
while(<T>){
   chomp;split;
   open(fil1,">$ARGV[0].pep");
   open(fil2,">$ARGV[0].dna");
   print fil1 ">$_[0]\n$pepseq{$_[0]}";
   print fil2 ">$_[0]\n$dnaseq{$_[0]}";
   $genewise=`genewise -quiet -genesf -pseudo -both $ARGV[0].pep $ARGV[0].dna `;
   print wise $genewise;}

perl ~/yangliandong/bin/split_file.pl pep.dna.pos 40
ls pep.dna.pos.*|awk {'print "perl temp.pl "$1" pe.dna.pos.seq  pep &"'} > genewise.sh  
bsub -n 20 -q high -o blast.out -e blast.err "sh bla.sh"

ssh compute-0-0
cd /home/clad/yangliandong/medaka/solar/genewise
nohup perl ~/yangliandong/bin/control_process.pl -i genewise.sh -c ~/yangliandong/bin/config.ini &
         

============================solar0501GeneWise09¨08°°×05á0101,0504080308°°××é000406060800080601090308×0708°°×===============================
mkdir solar
cd blast/
cat *.bla.out > ../solar/all.bla.out      ###0704246610002query08°°×###
cd ../solar
perl ~/yangliandong/bin/solar.pl  -cCn 10000000 -d -1 -z -f blast all.bla.out > all.bla.out.solar   ###0500・000704±0609080703080204ò0904°070606070000020403030409010803060304080501105§01òbp080502030201×070802×0607ó0008###0105070424589000208°°×

0503080904060301AA08050207×0609à0802region   ###06ò02090201pep040603010802×0606¤0802°±03ù09á04ò0904×060704070702050805pep090309050802±à000504ò0904###
open(fil,"all.bla.out.solar");
while ( <fil> ) {
     chomp;
     split;
     if($_[10] > $hash{$_[0]}) {
           $hash{$_[0]} = $_[10];
     }
}
open(fil,"all.bla.out.solar");
while ( <fil> ) {
     chomp;
     split;
     if($_[10] eq $hash{$_[0]}) {
           print "$_\n";
     }
}

perl temp.pl >all.bla.out.solar.best   ###all.bla.out.solar.best06010805×060201080204060301(2594700020405000405010800070424589000108°°×08020406030105010401000407ó07031080207043230002050107ó070310802×05040402091681000104050004050109ù06081681-323+24589=25947)0501080701030707020503á0704pep05é050400010007080204ò0904050106ò020903à01010802pep07070205080304000002050301010802020300010704080606¤08020406030105é0702###
rm temp.pl
*******************************************09080703genewise080205á010406090001±0809000609"040203ù06ò"********************************************
0909080703°×06020108020406030103±08070704040203ù06ò020106030408±06090805030506080204ò0904060906060800

08±060300010209050909á0803genewise05á01040602030009à070208±0501DealGeneWise000303á000306020401000408020603000205á0104050109ù0608090908070609×020408070708í0305      ###000309ù060803á06020300060300010209050909á0803genewise05á01040602030009à07020501080506ò0209050301010802pep07040707020502010101060309020209050909á04ò0904070403à09040408###

06080300±000805070708í0802050500è0502

00á060308°°×020300010501060302ó0003010700020209050909á04ò09040104×0005°07ò0703±ê0508
mkdir genewise
more all.bla.out.solar.best|awk {'print $1"\t"$6"\t"$5"\t"$8"\t"$9'} > genewise/dna.pos  ###dna.pos080701030703・03080208050201pep0704×060201040603010802020909á04ò09040802040808040203000104030304###
cd genewise 
07ò±ê0508                                                                                   ###0602010509090603050507ò±ê0508000302ó05010803best08070103±00050303á070400010007080204ò0904010406040909###

open(fil,"dna.pos");
open(file,">T");
while( <fil> ) { 
      $count++;
      print file "T$count\_$_";}
`mv T dna.pos`;

perl temp.pl                                                                             ###070908±0802dna.pos080701030703・030802pep0601050303á000100070909###
rm temp.pl 
0707RM080203ù06ò×édna080700á060308°°×±à000504ò09040501090908±08°°×±à00050209050909á04ò090408020104×00080504070909±ê050808020909                 ###06ò0209dna.pos080701030802010706030002000102070602010507ò±ê050802ó0601050303á00010007050109ù060800á0603060208070802all.bla.out.solar.best.dna080701030802010706030002pep090807070802020909á04ò09040601050303á03à0101090903050604010405030602010507ò±ê0508020506030505080203°0501060103á06020300050301010802020909á04ò09040908070703à01010802pep0501020505ù080203°0803070708ígenewise080205á010408±0501DealGeneWise000303á000306020401000408020603000205á0104###   
perl ~/yangliandong/bin/get_fa_from_genome.lixin.pl -p dna.pos -s ../../blast/dna_rm -o ../all.bla.out.solar.best.dna   ###0709070700á06030802020909á04ò0904080506020105solar060004ò090105070408080708020705dna.pos080701030802query04ò090404060301070308020603090206030902dna04ò0904080208×0205090509020802040800010203080008020506000808020407105010805060400á060306020802ENSORLP0000000000108°°×±à000503ù06ò0209374000020209050909á  05¨ENSORLP00000000001 441  46  384   -   2   31118443   4221653 4225392 7   318    46,80;81,183;177,207;205,255;251,295;298,359;351,384;   4225392,4225288;4224828,4224433;4223771,4223679;4222632,4222480;4222282,4222148;4222065,4221880;4221754,4221653;   -35;-98;-30;-50;-41;-56;-31;###060108054225392-4221653+108020008=3740

09080107000208°°×04°0401±à000504ò0904×02genewise   
more dna.pos|awk {'print $1"\t"$1'} > table                                              ###08¤0306070708í06030300###

#!/usr/bin/perl
#1 table 2 dna 3 pep
open(dna,"$ARGV[1]");
while ( <dna> ) {
   chomp;
   if ( />/ ) {
      split;
      $name=$_[0];
      $name=~s/>//;
   }  else {
      $dnaseq{$name}.=$_;        ###07090707070708í080205á010408050502080301060305 %dnaseq 0004070407030909±à0005pep0802020909á04ò09040802040303040501keys・00±080805all.bla.out.solar.best.dna080201070002000102070802±ê00090501values・00±080805±ê000903000103090807070802020909á04ò0904###
   }
}
open(pep,"$ARGV[2]");
while( <pep> ) {
   chomp;
   if( />/ ) {
      split;
      $name=$_[0];
      $name=~s/>//;
   }  else {
      $pepseq{$name}.=$_;        ###07090707070708í080205á010408050502080301060305 %pepseq 0004070407030909°±03ù09á04ò09040802040303040501keys・00±080805/blast/pep080201070002000102070802±ê00090501060506010805pep0802ID0501values・00±080805±ê000903000103090807070802°±03ù09á04ò0904###
   }
}

open(wise,">>$ARGV[0].wis");
open(T,"$ARGV[0]");
while( <T> ) {
   chomp;
   split;
   $_[1]=~s/_/\t/;
   ($odd,$name)=split(/\s+/,$_[1]);
   open(fil1,">$ARGV[0].pep");
   open(fil2,">$ARGV[0].dna");
   print fil1 ">$name\n$pepseq{$name}";                ###0803$ARGV[0].pep00040703・03010706030002pep0802ID--ENSORLP0000000000104°0401°±03ù09á04ò090404030304###
   print fil2 ">$_[0]\n$dnaseq{$_[0]}";                ###0803$ARGV[0].dna00040703・03010706030002pep0802±à0005020909á04ò0904040303040501±ê00090805T1_ENSORLP00000000001###
   $genewise=`genewise -quiet -genesf -pseudo -both $ARGV[0].pep $ARGV[0].dna `;    ###・00±080701pep080204ò09040705pep080204060301±à0005020909á04ò090405030404genewise±060908###
   print wise $genewise;                               ###°05010706030001genewise080205á0104×・04070009$ARGV[0].wis0004###
}

perl ~/yangliandong/bin/split_file.pl table 8
ls table.*|awk {'print "perl temp.pl "$1" ../all.bla.out.solar.best.dna  ../../blast/pep"'} > genewise.sh        ###070907070802all.bla.out.solar.best.dna0001020702092594705010903pep00010207020924661050109050908050303à0806080506ò0209×060201080204060301000403á07040400000203à08060802×0609àAa05é0702###
                                                                                                                 ###0701010706030002pep04ò0904090804010707020508°°×±à0005020909á04ò0904×02genewise050106030002pep070702050908070704000001050301010802020909á04ò090405010800010707020904080506030002pep070509ü0802±à000504ò090405030404genewise###
ssh compute-0-0
cd /home/clad/yangliandong/medaka/solar/genewise
nohup perl ~/yangliandong/bin/control_process.pl -i genewise.sh -c ~/yangliandong/bin/config.ini &


cat *.wis > all.wise    ###08070103070442169000108°°×020108°°×±à000503ù06ò0802genewise±06090805á010405010403070342171000108°°×080506ò0209・0008050000040308020500±03genewise07060800###
nohup perl ~/bin/DealGeneWise_both.pl -i all.wise -q ../../blast/pep &     ###08010805080205á0104020204060807middle.out.tab0805070404030304040400080802(42000000205010403070335・000802020916900020508###

090908070604010404ò0904000006¤0501dealgenewise0503020501ê06070501070702050609×0200010809070708í05030404
rm nohup.out temp.pl table.* genewise.sh* *.wis

±050900identity07ó070398%0501overlap07ó070390%050101090308×070805020707ó0703100020501050601030704frameshift0201stopcodon080204ò090405010909040808°°×070700010805070503ù06ò×é04ò0904±060908090402010506070409à000201090308×070802
more middle.out.tab |awk {'if($5>98 && $6>90 && $7>1 && $8<1 && $9<1)print'} > middle.out.tab.multi.exon  05¨302820001040303040508

06060001000705010503080904060301AA×0609à080202¨0603region
open(fil,"middle.out.tab.multi.exon");
while(<fil>){
     chomp;split;
     $cutoff=$_[4]*$_[5];                              ### $cutoff=$_[4]*$_[5]06010805060006・±06090807030802°±03ù09á/05020705±0609080802°±03ù09á * 05020705±0609080802°±03ù09á/08°°×0008×0506¤0309030905á010406010805060006・±06090807030802°±03ù09á090408°°×0008×0506¤0802°02・00±060501060507070608090808050406030107030802AA080208050207###
     if($cutoff>$hash{$_[0]}){
           $hash{$_[0]}=$cutoff;}                   
}
open(fil,"middle.out.tab.multi.exon");
while(<fil>){
     chomp;split;
     $cutoff=$_[4]*$_[5];
     if(($count{$_[0]}<1)&&($hash{$_[0]}==$cutoff)){       ###0603060204060301AA02¨0603080205060805×0609à080204ò0904###
            print "$_\n";
            $count{$_[0]}++;}                              ###07è0001$count{$_[0]}<109090002000104060805020909090603060202¨06030802050307ò050106ò02090707020506030002pep03á070504000002±à00050503070403à08060802±06090806¤0906050109ù06080003060306030002###                                                                  
}
perl temp.pl > middle.out.tab.multi.exon.best.and.uniq     ###080701030703・0308020601080504060301AA02¨0603080205060805×0609à080204ò090405¨302820001040303040508###×04000008°°×05¨09àexon08°°×05080705×04000003ù06ò0802genewise±06090805á0104

07ú0607070500030908070705¨06050601080504060301AA02¨060305060805×0609à080204ò090405080802uniq psl02020406
open(fil,"middle.out.tab.multi.exon.best.and.uniq");
while(<fil>){
     chomp;
     split;
     $flag{$_[1]}=1;
}
open(fil,"genewise2blat.psl");
while(<fil>){
     chomp;
     split;
     if ($flag{$_[13]}) {
       print "$_\n";
     }
}
perl temp.pl > genewise2blat.psl.multi.exon.best.and.uniq2     ###0709020204060209psl02020406,・05±0002ó0103000005030705×0703ù06ò000108060503×02×04±00###
rm temp.pl
more middle.out.tab.multi.exon.best.and.uniq|awk {'print $1'}|sort -u > ../pep_new.name   ###middle.out.tab.multi.exon.best.and.uniq0201pep_new.name0601080500ú×00060905ó05¨identity07ó070398%0501overlap07ó070390%050101090308×070805020707ó0703100020501050601030704frameshift0201stopcodon050104060301AA×0609à080202¨0603region05080802 pep04ò09040802pepID 0501070430282000100ú×00060905ó080204ò0904,0704070702050805000008°°×###


=================================solar40050109010507040100000403070340bp0802HSP======================================================
mkdir solar40
cd blast/
cat *.bla.out > ../solar40/all.bla.out
cd ../solar40
perl ~/yangliandong/bin/solar.pl  -cCn 40 -d -1 -z -f blast all.bla.out > all.bla.out.solar40      ###solar060004ò03á090105070905090204ò0904000304010403070340bp080204ò0904050105040506pep0503020500010806050100010806080203°060304060301×0602010802###

±060908050307ò($rough)07ó070350AA(060506010805$cutoff 07ó070370%)0506identity07ó07035005¨000305°02093005080802region
perl ~/bin/solar.cutoff.pl all.bla.out.solar40 all.bla.out.solar40.cutoff 05¨$rough>50 && $exact > 0 && $identity > 50 && $cutoff > 700508

06060001000705010803010106030002locus0603×0606¤0802region        ###0909080700ú07030603050505030101000307070803070309090807080505°0906×0606¤0802050307ò05010903070306030505080505°0906×060201080204060301###
mkdir  split
°07060607000002・000006solar02020406
cd split/
more ../all.bla.out.solar40.cutoff |perl ~/yangliandong/bin/split_solar_file_by_chr.pl            ###*.solar.by.chr0202040608070703・030802080501070002060607000002080701030802solar0202040605010605060108050203000108030107000206060700000207030802・040203060905ó0802all.bla.out.solar40.cutoff02020406###

ls *.chr|awk '{print "perl ~/yangliandong/bin/Findoverlap_from_solar.pl "$1" "$1".overlap"}'  > tmp.sh
nohup perl ~/bin/control_process.pl -i tmp.sh -c ~/bin/config.ini &                               

ls *.overlap|awk '{print "perl ~/yangld/bin/DifineType_only.pl "$1" "$1".define"}' >tmp11.sh
nohup perl ~/bin/control_process.pl -i tmp11.sh -c ~/bin/config.ini &

ls *.define|awk '{print "perl ~/yangld/bin/DeleteAli_only_for_solar.pl "$1" "$1".del "$1".family.list"}'>tmp22.sh
nohup perl ~/bin/control_process.pl -i tmp22.sh -c ~/bin/config.ini &

cat *.del > tmp
more tmp |cut -f1|sort -u >all.del.list 05¨060108050609060608000802000108060802hit0508
cd ..
perl ~/yangliandong/bin/Removed_tblast_overlap_hit.pl   all.bla.out.solar40.cutoff  split/all.del.list >gene.pos.for.genewise
05¨gene.pos.for.genewise06010805060306020802・05060807à0802020300010800080503ò0905±08050707ì09091000bp08020508

0905090900÷050106061000bp060807ó0703100bp0802region
more gene.pos.for.genewise|awk '{print $1"\t"$2"\t"$3"\t"$4+1000"\t"$5-1000}'  >gene.pos.for.genewise.mod   ###0905090900÷050106061000bp###  070472713000104ò0904
more gene.pos.for.genewise.mod|awk '{if (($5-$4)>=100) {print}}'  >gene.pos.for.genewise.mod_100            ###0709020204060703080206010805×0703ù06ò08020203000104030304###  07ó0703100bp0802070459707000104ò0904
perl ~/yangliandong/bin/get_fa_from_genome.lixin.pl -p gene.pos.for.genewise.mod_100 -s ../blast/dna_rm -o for_fasty.seq

rm -rf split/

for_fasty.seq06010805070508°°×070404060301080203ù06ò×é07030802×0606¤0802050307ò    ###09090408050307ò0805050302010704intron0802dna04ò0904  ###070702050805×0703ù06ò080204ò090405010704111440002###   

========================fasta0501080306060800080601090308×0708°°×080208°°××é000405°0906×06020108020406030105010701×0703ù06ò0908000008°°××02fasta0501090608050705×0703ù06ò04060301×0602010506020700010806020300010802000003ù06ò0501GeneWise09¨×0703ù06ò05á0101==========================
mkdir fasta
cd fasta
perl ~/yangliandong/bin/filt_seq_by_list.pl ../pep ../solar/pep_new.name   pep_new.name.seq          ###pep_new.name.seq0807010308050201070409à0002exon0802pep0802°±03ù09á04ò0904###
perl ~/yangliandong/binl/divide_fasta.pl  -i ../solar40/for_fasty.seq -od . -f2 -N 4
ls for_fasty.seq.f2.*|awk {'print "fasty36 -m 9 -Q -d 2 -H -b 100 "$1" pep_new.name.seq > "$1".fsy"'} > fsy.sh       ###0701for_fasty.seq.f2.*00040802070508°°×070404060301080203ù06ò×é07030802×0606¤0802020909á04ò0904  vs  0201070409à0002exon0802°±03ù09á04ò0904×02fasty###
nohup perl ~/bin/control_process.pl -i fsy.sh -c ~/bin/config.ini &
08090404fasty
cat *.fsy > all.fasty


###07030103090500020805070708í0605070007000802050103000103090500020805070708í05à÷F0802###
more all.fasty|perl -e '{while(<>) {if (/\d+>>>(\S+)/) {print  ">$1\n"}elsif(!/>>/ && /ENSGACP/&&/\[/&&/\(/) {s/\(.*?\)//; @temp=split; $identity=$temp[5];$alen=$temp[8];$query_len=$temp[11]; unless($temp[0]=~/Algorithm/i){print "$temp[0]\t$identity\t$alen\t\n" } } }}'  >all.fasty.information.short

more all.fasty|perl -e '{while(<>) {if (/\d+>>>(\S+)/) {print "$1\t"} elsif (!/>>/ && /ENSGACP/&&/\[/&&/\(/) {split;print "$_[0]\t"}   elsif(/^>>>/) {print "\n"}  } }'  > hit.table

more all.fasty|perl -e '{while(<>) {if (/\d+>>>(\S+)/) {print  ">$1\n"}elsif(!/>>/ && /ENSORLP/&&/\[/&&/\(/) {s/\(.*?\)//; @temp=split; $identity=$temp[5];$alen=$temp[8];$query_len=$temp[11]; unless($temp[0]=~/Algorithm/i){print "$temp[0]\t$identity\t$alen\t\n" } } }}'  >all.fasty.information.short        ###0703・030802080501070002×0703ù06ò±06090807030802000008°°×05¨000003ù06ò050808020104×0005010801・00050103à09040408###

more all.fasty|perl -e '{while(<>) {if (/\d+>>>(\S+)/) {print "$1\t"} elsif (!/>>/ && /ENSORLP/&&/\[/&&/\(/) {split;print "$_[0]\t"}   elsif(/^>>>/) {print "\n"}  } }'  > hit.table    ###0703・030802080501070002×0703ù06ò±06090807030802000008°°×08020104×00###

more all.fasty|perl -e '{while(<>) {if (/\d+>>>(\S+)/) {print  ">$1\n"}elsif(!/>>/ && /ENSDARP/&&/\[/&&/\(/) {s/\(.*?\)//; @temp=split; $identity=$temp[8];$alen=$temp[10];$query_len=$temp[11]; unless($temp[0]=~/Algorithm/i){print "$temp[0]\t$identity\t$alen\t\n" } } }}'  >all.fasty.information.short
more all.fasty|perl -e '{while(<>) {if (/\d+>>>(\S+)/) {print "$1\t"} elsif (!/>>/ && /ENSDARP/&&/\[/&&/\(/) {split;print "$_[0]\t"}   elsif(/^>>>/) {print "\n"}  } }'  > hit.table

rm for_fasty.seq.f2.* fsy.sh* nohup.out pep_new.name.seq

0503080907050003040603010801×0602010800020700010806020300010802040603010501060506010805090608050705×0703ù06ò04060301×0602010802×04000003ù06ò
#1,candidate,2,pep,3,retro_pep,4,best.table
open(T1,"$ARGV[0]");
while (<T1>) {                                ###070708í02ó08010805×0703ù06ò080206060700000204°040800010203000104030304###
@temp=split;
$chr{$temp[0]} =$temp[1] ;
$start{$temp[0]} =$temp[-2] ;
$end{$temp[0]} =$temp[-1] ;
}
open(T2,"$ARGV[1]");
while (<T2>) {                                ###070708í02ó0801080508020805000003ù06ò080206060700000204°040800010203000104030304###
@temp=split;
$chr{$temp[0]} =$temp[1] ;
$start{$temp[0]} =$temp[-2] ;
$end{$temp[0]} =$temp[-1] ;
}
open(T3,"$ARGV[2]");
while(<T3>){
   chomp;split;
   $dna{$_[0]}=$_[1];
  }
open(T4,"$ARGV[3]");
while(<T4>) {
   @temp3=split;
   for($i=1;$i<@temp3;$i++ )  {
        $dna=$dna{$temp3[$i]};
        if($chr{$temp3[0]}  ne $chr{$dna}) {    ###06040104×0703ù06ò0201000003ù06ò080206060700000205030001080605010205010702030001070309¨050300010806###
             $best{$temp3[0]} =$temp3[$i] ;     ###000306090203000106・09¨090905030001080602ó050100±0507060306020803060300010403030406010805040603010802×0602010802050106ò020906020105fasta02ó0805°0709090801・000008080106080702030309040802###                                          
             last;
        } elsif($start{$temp3[0]}  > $end{$dna} || $end{$temp3[0]} < $start{$dna}  ) {   ###06040104×0703ù06ò0802040808040203000107ó0703000003ù06ò0205090903ò0908×0703ù06ò08020205090907ó0703000003ù06ò08020408080405010205010709050908020300010605050300010806###
             $best{$temp3[0]} =$temp3[$i] ;                                              
             last;
        } else {
             next;
        }
   }
}
foreach $key (sort keys %best)
{
print "$key\t$best{$key}\n"  ;
}
perl temp.pl ../solar40/gene.pos.for.genewise.mod_100 ../solar/genewise/dna.pos ../solar/genewise/middle.out.tab.multi.exon.best.and.uniq hit.table  > best.hit      ##0704597070001,±í08060704597070001070702050802×0703ù06ò###
rm temp.pl

0803×060201080204060301best.hit000406080606all.fasty.information.short08070103fasta08020801・0004°identity0403030409060805score07ó070310004°identity07ó07030.8080200010207

###070402080009###
open T1,"best.hit";
while (<T1>) {
    chomp;
    split;
    $par{$_[0]} = $_[1];
}
open T2,"all.fasty.information.short";
while (<T2>) {
    chomp;
    if (/>/) {
        s/>//;
        $retro = $_;
        $parent = $parent{$retro};
    } elsif (/$parent/) {
        print "$retro\t$_\n";
    } else {
        next;
    }
}
###


open(fil,"best.hit");
while(<fil>) {
      chomp;split;
      $par{$_[0]}=$_[1];
}
LABEL:for $key (keys %par){
            $value = $par{$key};
            open(fil,"all.fasty.information.short");
            while(<fil>) {
                 if(/>/) {
                     if(/$key/) {
                         $flag=1;
                     } else {
                         $flag=0;
                     }
                 }      
                 if($flag){
                      unless(/\_/){
                          chomp;split;
                          if($_[0] eq $value){
                               $score = $_[1];
                               $identity = $_[2];
                          }
                          print "$key\t$value\t$score\t$identity\n";
                          $flag = '';
                          next LABEL;
                      }
                 }
             }
}
        
perl temp.pl > best.hit.score.identity
±050900score07ó0703900501identity07ó07030.8
more best.hit.score.identity |awk {'if($3>90 && $4>0.8)print $1"\t"$2'} > best.hit.score.identity.cutoff  ###05à÷F070415616000100ú×00060905ó08020001020705¨×060400080506060508###

rm temp.pl 
×0703ù06ò07030300050707ì1wbp05010908#000008°°×#×02genewise

mkdir genewise
cd genewise/
more ../../solar40/gene.pos.for.genewise.mod_100|perl -e {'while(<>){chomp;split;$start=$_[-2]-10000;$end=$_[-1]+10000;if($start>0){}else{$start=1;}print "$_[0]\t$_[1]\t$_[2]\t$start\t$end\n"}'} > gene.pos.for.genewise.mod_100.mod     ###×0703ù06ò07030300050707ì1wbp###
perl ~/yangliandong/bin/get_fa_from_genome.lixin.pl -p gene.pos.for.genewise.mod_100.mod -s ../../blast/dna_rm -o gene.pos.for.genewise.mod_100.mod.seq
perl ~/yangliandong/bin/split_file.pl ../best.hit.score.identity.cutoff 4
ls best.hit.score.identity.cutoff.*|awk {'print "perl ~/yangliandong/bin/run_genewise.pl "$1" gene.pos.for.genewise.mod_100.mod.seq ../../Oryzias_latipes.MEDAKA1.62.pep.all.fa"'} > wis.sh
perl ~/yangliandong/bin/split_file.pl wis.sh 2

(
×04060902020203070307ó0403
ssh compute-0-13
top
cd /home/zouming/Cjaponica/WB_Ppacificus/fasta/genewise
nohup perl ~/bin/control_process.pl -i wis.sh.1.2 -c ~/bin/config.ini &
)

070708ígenewise080205á0104
cat *.wis > all.wise  ###080701030704111160002genewise±06090805á010405010201best.hit.score.identity.cutoff080701030805020708050603000008020501090801÷±06090805á010401ê0600090506・###
nohup perl ~/yangld/bin/DealGeneWise_both.pl -i all.wise -q ../../pep &
nohup perl ~/yangliandong/bin/DealGeneWise_both.pl -i all.wise -q ../../Oryzias_latipes.MEDAKA1.62.pep.all.fa &

rm best.hit.score.identity.cutoff.* wis.sh* nohup.out

05030809080601090308×0704ò0904
more middle.out.tab |awk {'if($7<2)print'} > middle.out.tab.single.exon      ###080601090308×0704ò0904050300ü0704070702050805retrogene050105à÷F0704136960002###

05030809000907020704 2 000202030201×0705010506070502030201×070905±0801090308×070001080607ó0703100002AA   
mkdir overlap10
cd overlap10
perl ~/yangliandong/bin/remove_one_jiang.pl ../../../pep_genewise/genewise2blat.psl.multi.exon.best.and.uniq2 ../genewise2blat.psl 10 > remove_one_jiang  #00030609090908§06030002intron0802×04×0703ù06ò060103á±03±05090003000807050105à÷F0704115910002

05ó09050908080205030404050106050601080505°090604060805080601090308×0703ù06ò0700090908§00090702 2 000202030201×07080203ù06ò
open(fil,"remove_one_jiang");    
while(<fil>){
   chomp;split;
   $count{$_[2]}++;}
open(fil,"../middle.out.tab.single.exon");   
while(<fil>){
     chomp;split;
     if($count{$_[1]}>1){
         print "$_\n";}
}

perl temp.pl > remove_one_jiang.single.exon.and.missed.introns
rm temp.pl

09í01090501±0607030802050307ò±0104050705retro04ò0904070400010806
open(fil,"../../../solar40/for_fasty.seq");
while(<fil>){
   chomp;
   if(/>/){
   s/>//;
   $name=$_;}else{
   $seq{$name}.=$_;}
  }
while(($key,$value)=each %seq){
   $length=length($value);
   $hash{$key}=$length;}
open(fil,"remove_one_jiang.single.exon.and.missed.introns");
while(<fil>){
   $overlap='';$cutoff='';$start='';$end='';
   chomp;split;
   $start=10000+1;
   $end=10000+$hash{$_[1]};
   if($start<=$_[-2] && $end>$_[-2] && $end<$_[-1]){
   $overlap=$end-$_[-2]+1;}
   elsif($start<=$_[-2] && $end>=$_[-1]){
   $overlap=$_[-1]-$_[-2]+1;}
   elsif($start>=$_[-2] && $start<$_[-1] && $end>$_[-2] && $end<=$_[-1]){
   $overlap=$end-$start+1;}
   elsif($start>=$_[-2] && $start<$_[-1] && $end>=$_[-1]){
   $overlap=$_[-1]-$start+1;}
   $cutoff=$overlap/$hash{$_[1]};
   if($cutoff>0){
   print "$_\t$start\t$end\t$overlap\t$cutoff\n";}
  }

perl temp.pl > remove_one_jiang.single.exon.and.missed.introns.overlap  #080305à÷F0004000305030809090908§20002intron060807030802×0703ù06ò0501×÷020902ó0403・00020205¨6480002retrocopy05010605070007008800020508
rm temp.pl

================================================check============================================================
mkdir check
cd check
cp ../fasta/genewise/overlap10/remove_one_jiang.single.exon.and.missed.introns.overlap .
・05±00060901¤check050101070002000003ù06ò×0703ù06ò0908・0306030002020204060404
mkdir parentgene_retrogene
#!/usr/bin/perl
open(fil,"../pep_genewise/middle.out.tab.multi.exon.best.and.uniq");
while(<fil>){
    chomp;split;
    $dna{$_[0]}=$_[1];
   }
open(fil,"remove_one_jiang.single.exon.and.missed.introns.overlap");
open(fil1,"../pep_genewise/all.wise");
open(fil2,"../fasta/genewise/all.wise");
@a=<fil1>;@b=<fil2>;
$a=join('',@a);
$b=join('',@b);
@parent=split(/genewise\s+\$Name:\s+wise2\-2\-0\s+\$\s+\(unreleased\s+release\)/,$a);
@retro=split(/genewise\s+\$Name:\s+wise2\-2\-0\s+\$\s+\(unreleased\s+release\)/,$b);
while(<fil>){
  chomp;
  split;
  $temp="$_[0]\_$_[1]";
  `mkdir parentgene_retrogene/$temp`;
  open(ff1,">parentgene_retrogene/$temp/parentgene.wis");
  open(ff2,">parentgene_retrogene/$temp/retrogene.wis");
  for $parent(@parent){
      $flag='';
      @lines=split(/\s+/,$parent);
      for $line(@lines){
         if($line eq $_[0]) {
             $flag=1;
         }
         if (($flag) && ($line eq $dna{$_[0]})) {
             print ff1 $parent;
             last;
         }
      }
  }
  for $retro(@retro){
      $flag='';
      @lines=split(/\s+/,$retro);
      for $line(@lines){
          if($line eq $_[0]){
             $flag=1;next;
          }
          if (($flag) && ($line eq $_[1])){
             print ff2 $retro;
             last;
          }
      }
   }
}
nohup perl temp.pl &


###08030605070007000004・040300880002retro080204010902,080305à÷F00040704648000202010704retro080204010902### 

###check0004・040300080306050700070000040802retrogene070402050201080205á0101050109à0002intron0802090908§030003ó020501÷0308050109030506020507ó±0608050805intact gene, WHY050705070501020508080705060507000700080205000902・00030407050500090202070000040206070704010105070507###


*****************************************************060401040103070405á010405010707020508050203070303040202000007ó************************************
more ../remove_one_jiang.single.exon.and.missed.introns.overlap |awk {'print "mkdir "$1"_"$2""'} > temp

more temp |sh  ###05¨090401070002000003ù06ò×0703ù06ò09080802020204060404###
060302ó08020101±09060004ò0807`mkdir parentgene_retrogene/$temp`;0601070706080909
rm temp

**************************************************************************************************************************
more remove_one_jiang.single.exon.and.missed.introns.overlap |awk {'print "../"$1"_"$2"\t"$1"\t"$2""'} > remove_one_jiang.single.exon.and.missed.introns.xls
check01ê±0302ó050109í07030209txt000908050504070307000009check	
more remove_one_jiang.single.exon.and.missed.introns.txt|perl -e {'while(<>){chomp;split(/\t+/,);unless($_[5]=~/[id\*]/i){if($_[3]=~/t/i){print "$_\n"}}}'} > par_son.txt
more remove_one_jiang.single.exon.and.missed.introns.txt|awk {'print ""$2"\t"$3""'} > par_son.txt

more remove_one_jiang.single.exon.and.missed.introns.txt|awk '{print $2"\t"$3}' > par_son.txt  ###0107020501010703010309050505###
03000801par_son.txt050407060605remove_one_jiang.single.exon.and.missed.introns.txt
090807030807×08010106030002000003ù06ò0802retrogene05010603090307ó05é,00÷0609070702030001080505030805070400010806
open(fil,"par_son.txt");
while(<fil>){
    chomp;split;
    if($_[3] eq 't'){
    $count{$_[1]}++;}
   }
while(($key,$value)=each %count){
   if($value>1){
       print "$key,$value\n";}
  }
perl temp.pl > temp
00010400windows030007ó05étemp0807080208050606050101ê02ó±05090009030905retrogene050109í07030209txt000908050504070307000009check0501CuteFTP060307ú"

==============================================express============================================================
mkdir express
cd express
cp ../RM/dna.masked .
07030700±í070708050606sequences.fasta0805express03ò0908wget00±05070707UCSC03000801  ###06050700070003ù06ò×é06030105070418440001sequence0501±í070708050606mRNA07042382000104ò09040501est.fa080707042769920002est###
                                                    ###  05à÷F03ù06ò×é06030105070471880001sequence0501mRNA07041049000104ò09040501est0704666891000104ò0904###
mkdir clean                                           
cd clean
seqclean:	nohup seqclean ../sequences.fasta -v /home/zouming/tools/seqclean/UniVec -c 4 &
cd ..
0500±í070704ò0904070503ù06ò×é×02blat
mkdir blat1
cd blat1
blat1:	 	nohup blat ../dna.masked ../clean/sequences.fasta.clean  -noHead output.psl &

05030809mapping length>=100 bp, identity>=97%, coverage within mapping>=97% and coverage within whole transcript>=75%080209080203
more output.psl |perl -e {'while(<>){chomp;split; undef $iden;undef $sum; undef @temp; undef $map_length;undef $within_map_cov;undef $cov; @temp=split(/,/,$_[-3]);for ($i=0;$i<@temp;$i++){$sum+=$temp[$i];} $map_length=$_[12]-$_[11];$within_map_cov=$sum/$map_length;$cov=$map_length/($_[10]); $iden=$_[0]/$sum;if($map_length>=100 && $iden>=0.97 && $within_map_cov>=0.97 && $cov>=0.75){print "$_\n"} }'} > output.psl.cutoff

0503080904060301040603ù08050207×0609à0802050105060601010504060301070209à08022%080204060301
open(fil,"output.psl.cutoff");
while(<fil>){
    chomp;split;
    if(!exists $first{$_[9]}){
           $first{$_[9]}=$_[0];
           $first_result{$_[9]}=$_;
       }
    elsif($_[0]>=$first{$_[9]}){
           $second{$_[9]}=$first{$_[9]};
           $second_result{$_[9]}=$first_result{$_[9]};
           $first{$_[9]}=$_[0];
           $first_result{$_[9]}=$_;}
    else  {next;}
 }
for $key(keys %first){
    $temp=$second{$key}*1.02;
    if($temp<=$first{$key}){
        print "$first_result{$key}\n";
    }
}
perl temp.pl > output.psl.cutoff.minus.dup.uniq

cd ..

0500retro04ò0904090803ù06ò×é×02blat
mkdir blat2
°050705000008°°×±060703080204ò090400010400blat080503ù06ò×é07030606

00á0603±060703080204ò0904
open(fil,"../fasta/genewise/multiple_sequence.out");      ###multiple_sequence.out0807010309040805×0703ù06ò08020104×0004°09080707080204ò0904###
while(<fil>){
  chomp;split;
  $_[1]=~s/-//g;
  $_[1]=~s/\d//g;
  $seq{$_[0]}=$_[1];}
open(fil,"../check/par_son.txt");
while(<fil>){
  chomp;split;
  print ">$_[1]\n$seq{$_[1]}\n";
}
perl temp.pl > son.seq    #×0703ù06ò080204ò0904

mv son.seq  blat2/
rm temp.pl
cd blat2
nohup blat ../dna.masked son.seq -noHead output.psl &

open(fil,"output.psl");
while(<fil>){
     chomp;split;
     if($_[0]>$hash{$_[9]}){
           $hash{$_[9]}=$_[0];}
}
open(fil,"output.psl");
while(<fil>){
     chomp;split;
     if($_[0] eq $hash{$_[9]}){
           print "$_\n";
         }
   }
perl temp.pl > output.psl.best  ###080305à÷F080707041160000104ò09040501080306050700070000040704124000104ò0904###

00ù0606retro08020104×0000040802020300010403030404070002blat05á01040801000302¨0603
rm temp.pl nohup.out

01060404est0705retro04ò090400010806040603ù080208050207050107ó0703150bp08ò08010602    ###0206070108020805100bp###
open(fil1,"output.psl.best");
open(fil2,"../blat1_est/output.psl.cutoff.minus.dup.uniq");
@f1=<fil1>;@f2=<fil2>;
for $f1(@f1){
    print "$f1";
    chomp $f1;
    @t1=split(/\s+/,$f1);  #start $t1[-6], end $t1[-5]
    for $f2(@f2) {
        undef $sum; undef $length;
        chomp $f2;
        @t2=split(/\s+/,$f2);
        if($t1[13] eq $t2[13]){
            @block_sizes=split(/,/,$t2[-3]);
            @block_starts=split(/,/,$t2[-1]);
            for ($i=0;$i<@block_sizes;$i++){
                $block_start=$block_starts[$i];
                $block_end=$block_start+$block_sizes[$i]-1;
                if($block_start<=$t1[-6]&&$block_end<=$t1[-6]){
                         $length=0;}
                elsif($block_start<=$t1[-6]&&$block_end>$t1[-6]&&$block_end<=$t1[-5]){
                         $length=$block_end-$t1[-6]+1;}
                elsif($block_start<=$t1[-6]&&$block_end>=$t1[-5]){
                         $length=$block_sizes[$i];}
                elsif($block_start>=$t1[-6]&&$block_start<$t1[-5]&&$block_end<=$t1[-5]){
                         $length=$block_end-$block_start+1;}
                elsif($block_start>=$t1[-6]&&$block_start<$t1[-5]&&$block_end>=$t1[-5]){
                         $length=$t1[-5]-$block_start+1;}
                else {$length=0;}  
            $sum+=$length;
            }
       }
       if($sum>=100){print "$f2\n";}
   }
   print "//\n";
}
nohup perl temp.pl > retro.est.overlap &    ###09080707070306030002retrocopy05010707020503á070404000001est040603010703###


05é07070704±í07070802retro08050207
open(fil,"$ARGV[0]");
$/='//';               #perl07070508000403°$/03±080504050004・000000・0405010201060305é0702030008060703"\n",0707060800ù060604è06090002±01
while(<fil>){
    $count='';
    chomp;
    split(/\n+/,$_);
    for $temp (@_){
        if($temp){
            $count++;}
    }
    if($count>1){print "$_//";}
}
perl temp.pl retro.est.overlap > retro.est.overlap.clean 
perl temp.pl retro.mrna.overlap > retro.mrna.overlap.clean    
                                                                
rm temp.pl

010604040704±í07070805060600§06000802retro080208050207
open(fil,"$ARGV[0]");  
$/='//';               #perl07070508000403°$/03±080504050004・000000・0405010201060305é0702030008060703"\n",0707060800ù060604è06090002±01
while(<fil>){
    chomp;
    split(/\n+/,$_);
    for $temp (@_){
        if ($temp=~/ENSORLP/) {
            @retro=split /\s+/, $temp;
            $retro_name=$retro[9];
        }
        if($temp){
            $count{$retro_name}++;
        }
    }
    $num=$count{$retro_name}-1;
    if($num>0){print "$retro_name\t\t$num\n";}
}

perl temp.pl retro.mrna.overlap.clean > mrna_num    #0605070007000004retrocopy0704mrna00§06000802020940002050105à÷F0004070420002
perl temp.pl retro.est.overlap.clean > est_num      #0605070007000004retrocopy0704est00§060008020209340002,05à÷F00040704490002

00á0603060207050704±í07070802×0703ù06ò0802040603010802est03ò0908mrna0802genebank080500040203
open fil, "$ARGV[0]";
$/="//";
while (<fil>) {
    chomp;
    undef @retro; undef @est; undef @est_name;undef $retro_name; undef $num;
    split /\n+/, $_;
    for $temp (@_) {
        if ($temp=~/ENSGACP/) {
            @retro = split /\s+/, $temp;
            $retro_name = $retro[9];
        }else {
            @est=split /\s+/, $temp;
            push @est_name, $est[9];  
        }
    }
     $num=(@est_name-1);
     print "$retro_name\t$num";
     for $e (@est_name) {
	 print "$e\n";                          #0704±í07070802×0703ù06ò090807070802est03òmrna0805×0603ò07ò0703
     }
}

perl temp.pl retro.mrna.overlap.clean > retro_mrna_name_num
perl temp.pl retro.est.overlap.clean > retro_est_name_num 

0803NCBI03000801±í070708050606est03ò0908mrna0802±í070705070203
open fil, "$ARGV[0]";
while (<fil>) {
	chomp;
    if (/ENSGACP/) {
	    split;
		$sum+=$_[1];
	} else {
	    print "$_\n";
	}
}
print "$sum\n";

perl temp.pl retro_mrna_name_num > mrna.list    #mrna0403030405à÷F07042050106050700070007044
perl temp.pl retro_est_name_num > est.list      #est0403030405à÷F07041025050106050700070007041201

00á0603×é000404°・04070505×0902080604030304
open fil, "retro_est_name_num";
@ests = <fil>;
for $est (@ests) {
    unless ($est=~/ENSORLP/) {
         chomp $est;
           print "$est\t";
         open fil1, "medaka.est.txt";
         $/='//'; 
         while (<fil1>) {  
              if (/$est/) { 
                   @tissue= split /\n+/, $_;
                      for $temp (@tissue) {
                          chomp $temp;
                      if ($temp=~/sex|tissue_type|dev_stage/) {$temp=~s/\s+//;print "$temp\t";}
                   }
                      print "\n";
              }
         }
    }
}

perl temp.pl > est.sex.tissue.stage   #05à÷F0802est0908070708020408±080501×é00040501・04070505×0902 

080205000703010305á0104080001¤000209040603030005010801080105á0104060702090901040308020603040406030404080204030304

09080408±080501×é00040501・04070505×09020403030407030304070708í
#070708í05à÷F0802060004ò
open fil, "1.txt";
@list=<fil>;
for $b (@list) {
      chomp $b;
      @a=split /\t/, $b; 
      print "$a[0]\t"; 
      if ($a[1]=~/sex/) {
          for $c (@a) {
              if ($c=~/=/) {
                 $c =~s/"//g;
                 @m=split /=/,$c;
                 print "$m[1]\t";
              }    
          }    
      } else { print "\t";
          for $d (@a) {
              if ($d =~/=/) {
                 $d =~s/"//g;
                 @n=split /=/,$d;
                 print "$n[1]\t"; 
              }
          }
      }
      print "\n"; 
}
#070708í0605070007000802060004ò
open fil, "est.sex.tissue.stage.txt";
@list=<fil>;
for $b (@list) {
      chomp $b;
      @a=split /\t/, $b; 
      print "$a[0]\t"; 
      for $c (@a) {
         if ($c=~/=/) {
             $c =~s/"//g;
             @m=split /=/,$c;
             print "$m[1]\t";
         }
      } print "\n"; 
}
perl temp.pl > est.sex.tissue.stage.xls  #×060009080205á0104

===========================================primer=================================================================
mkdir primer
cd primer
retro04ò09040705map080503ù06ò×é07030802est01090308×070203000100010806100bp080204060301
open(fil1,"../express/blat2/output.psl.best");
open(fil2,"../express/blat1/output.psl.cutoff");
@f1=<fil1>;@f2=<fil2>;
for $f1(@f1){
    print "$f1";
    chomp $f1;
    @t1=split(/\s+/,$f1);#start $t1[-6] end $t1[-5]
    for $f2(@f2){
    undef $sum; undef $length;
    chomp $f2;
    @t2=split(/\s+/,$f2);
       if($t1[13] eq $t2[13]){
       @block_sizes=split(/,/,$t2[-3]);
       @block_starts=split(/,/,$t2[-1]);
       for ($i=0;$i<@block_sizes;$i++){
           $block_start=$block_starts[$i];
           $block_end=$block_start+$block_sizes[$i]-1;
           if($block_start<=$t1[-6]&&$block_end<=$t1[-6]){
                $length=0;}
           elsif($block_start<=$t1[-6]&&$block_end>$t1[-6]&&$block_end<=$t1[-5]){
                $length=$block_end-$t1[-6]+1;}
           elsif($block_start<=$t1[-6]&&$block_end>=$t1[-5]){
                $length=$block_sizes[$i];}
           elsif($block_start>=$t1[-6]&&$block_start<$t1[-5]&&$block_end<=$t1[-5]){
                $length=$block_end-$block_start+1;}
           elsif($block_start>=$t1[-6]&&$block_start<$t1[-5]&&$block_end>=$t1[-5]){
                $length=$t1[-5]-$block_start+1;}
           else {$length=0;}  
       $sum+=$length;
      }
     }
           if($sum>=100){print "$f2\n";}
    }
           print "//\n";
}
perl temp.pl > retro.est.express
060608000503±í07070802050108050300000706030802±í07070802retro0201EST
open(fil,"$ARGV[0]");
$/='//';
while(<fil>){
    $count='';
    chomp;
    split(/\n+/,$_);
    for $temp (@_){
        if($temp){
            $count++;}
      }
    if($count>1){print "$_//";}
}
perl temp.pl retro.est.express > retro.est.express.clean
00á0603±í07070802retro08020104×00
more retro.est.express.clean |perl -e {'while(<>){if(/_/){split;print "$_[9]\n"}}'} > retro.est.express.clean.names
00á060309ù0704retro08020104×00
more ../check/par_son.txt |awk {'print $3'} > temp
09ù0704retro04010606±í07070802retro0805030001030704±í07070802retro
perl ~/bin/minus.pl temp retro.est.express.clean.names  > retro.est.noexpress.clean.names
rm temp
00á060301030704±í07070802retro080204ò0904060804°07050003090807070802000003ù06ò04ò0904,080805é05é00¤08±07040005000003ù06ò0201×0703ù06ò080206ì0101
perl ~/bin/filt_seq_by_list.pl ../express/blat2/son.seq retro.est.noexpress.clean.names retro.est.noexpress.clean.names.seq
open(fil,"../check/par_son.txt");
while(<fil>){
   chomp;split;
   $par{$_[2]}=$_[1];}
open(fil,"../solar/genewise/middle.out.tab.multi.exon.best.and.uniq");
while(<fil>){
   chomp;split;
   $dna{$_[0]}=$_[1];}
open(fil,"../solar/genewise/multiple_sequence.out");
while(<fil>){
    s/-//g;chomp;split;
    $sequence{$_[0]}=$_[1];}
open(fil,"retro.est.noexpress.clean.names.seq");
while(<fil>){
    chomp;
    if(/>/){
    s/>//;
    $name=$_;}else{
    $seq{$name}.=$_;}
  }
open(fil,"retro.est.noexpress.clean.names");
while(<fil>){
    chomp;
    $par_noexpress=$par{$_};
    $dna_noexpress=$dna{$par_noexpress};
    $sequence_par_noexpress=$sequence{$dna_noexpress};
    $sequence_son_noexpress=$seq{$_};
    print ">$_\n$sequence_son_noexpress\n";
    print ">$dna_noexpress\n$sequence_par_noexpress\n";
    print "//\n";}
perl temp.pl  > temp
mv temp retro.est.noexpress.clean.names.seq
rm temp.pl


***************************************************chimeric080805é***********************************************************
mkdir chimeric
cd chimeric
cp ../../chimeric/chimeric temp
cp  ../solar/genewise/multiple_sequence.out .

1050100á0603chimeric08°°×±à000504ò090405010504blast090604060301est
open(fil,"multiple_sequence.out")||die "$!";
while(<fil>){
  s/-//g;chomp;split; 
  $seq{$_[0]}=$_[1];}
open(fil,"temp");
while(<fil>){
  chomp; 
  $seq=$seq{$_};
  print ">$_\n$seq\n";
  }
perl temp.pl > chimeric.coding.seq

rm multiple_sequence.out temp*
cp ../../express/clean/sequences.fasta.clean . (0401090402070000,00030805020909090801080506¤0906 cp chimeric.coding.seq sequences.fasta.clean)
formatdb -i sequences.fasta.clean -p F
blastall -p blastn -i chimeric.coding.seq -d sequences.fasta.clean -F F -e 1e-20 -o temp.bla.out
solar.pl -n 100000 -d -10000  temp.bla.out  > temp.bla.out.solar
06ò0209e000802050503000909ù06080503070104040900cutoff050109í0109050107070703genewise0802080206ò0501070702050301070402030201×0701030704060608000501090006020802identity0707020502050801
mv temp.bla.out.solar chimeric.coding.est.hits
rm sequences.fasta.clean* temp.bla.out formatdb.log

205010908chimeric×020408070708í0501060405020605chimeric080206¤0906,×ó07060905±0803à0908retro09à0602080206¤0906060804°×ó07060905±08070702050802retro0802±080504
090604ò08050502000003ù06ò0501retrocopy0501chimericgene0501chimeric06¤09060501×ó±0809à060206¤09060501×ó±0807070205±08050405010706±0807070205±08050405010706±0809à060206¤0906
no_left_length07ú±íchimeric×ó±0801030704±06retro09à07à04ò0904
no_left_parent07ú±íchimeric×ó±0809à060204ò0904050308050807×08000003ù06ò000502§
no_right_parent07ú±íchimeric0706±0809à060204ò0904050308050807×08000003ù06ò000502§
no_right_length07ú±íchimeric0706±0801030704±06retro09à07à04ò0904
cp ../../chimeric/chimeric .
cat ../../chimeric/chimeric1.left ../../chimeric/chimeric2.left > chimeric.left
cat ../../chimeric/chimeric1.right ../../chimeric/chimeric2.right > chimeric.right
open(fil,"../../chimeric/chimeric.coding.pos.left");
while(<fil>){
     chomp;split;
     $left_length{$_[0]}=$_[1];}
open(fil,"chimeric.left");
while(<fil>){
     chomp;split;
     $left_flag{$_[2]}++;
     $left_parent{$_[2]}=$_[4];
     $parent_left{$_[2]}=$_[0];
     $retro_left{$_[2]}=$_[1];}
open(fil,"chimeric.coding.est.hits");
while(<fil>){
     chomp;split;
     $length{$_[0]}=$_[1];}
open(fil,"../../chimeric/chimeric.coding.pos.right");
while(<fil>){
     chomp;split;
     $right_length{$_[0]}=$_[1];}
open(fil,"chimeric.right");
while(<fil>){
     chomp;split;
     $right_flag{$_[2]}=$_[3];#00±05070701right_parent×02±ê040503á0605040802ó03á050106ò0209$length02090903
     $right_parent{$_[2]}=$length{$_[2]}-$_[3]+$_[5];
     $parent_right{$_[2]}=$_[0];
     $retro_right{$_[2]}=$_[1];}
open(fil,"chimeric");
while(<fil>){
      chomp;
      if($parent_left{$_}){
      print "$parent_left{$_}\t";}else{
      print "$parent_right{$_}\t";}
      if($retro_left{$_}){
      print "$retro_left{$_}\t";}else{
      print "$retro_right{$_}\t";}
      print "$_\t";
      print "$length{$_}\t";
      if($left_length{$_}){print "$left_length{$_}\t";}else{print "no_left_length\t";}
      if($left_flag{$_}&&$left_parent{$_}){print "$left_parent{$_}\t";}elsif($left_flag{$_}){print "no_left_parent\t";}else{print "not_long_enough\t";}
      if($right_flag{$_}&&$right_parent{$_}){print "$right_parent{$_}\t";}elsif($right_parent{$_}){print "no_right_parent\t";}else{print "not_long_enough\t";}
      if($right_length{$_}){print "$right_length{$_}\n";}else{print "no_right_length\n";}
     }
perl temp.pl > chimeric.xls
rm temp.pl
=================================================chimeric============================================================
mkdir chimeric
cd chimeric/
01090308×070705×0703ù06ò070400010806080208°°×050106060605×0703ù06ò04ò09040501060302ó0705000003ù06ò04°0401070303001wbp ×02±06090805¨070400050001×é080607°03ì050705080501000306090603090907040603090207ó070350bp04ò090401030704hit050108ò060302090805chimeric

1, cp ../pep_genewise/genewise2blat.psl  ../pep_genewise/middle.out.tab  .     ###ensembl000409ù0608×040801080208°°×05¨246610002pep050108000003070424615000205á01040508070503ù06ò×é07030802±à0005DNA×02genewise±060908080205á0104###06020105070708ígenewise0802060004ò070708í000302ó0501・000805080107033508020500±03×08090407060605
±050900identity07ó070398%0501overlap07ó070390%, 050601030704frameshift0201stopcodon080204ò090405010909040808°°×070700010805070503ù06ò×é04ò0904±060908090402010802
more middle.out.tab |awk {'if($5>98 && $6>90 && $8<1 && $9<1)print'} > middle.out.tab.all.exon  05¨18563000205á01040508

07ú060707050003090807070802psl02020406
open(fil,"middle.out.tab.all.exon");
while(<fil>){
     chomp;split;
     $flag{$_[1]}=1;}
open(fil,"genewise2blat.psl");
while(<fil>){
     chomp;split;
     if($flag{$_[13]}){
     print "$_\n";}
  }
perl temp.pl > genewise2blat.psl.all.exon    ###185630002・040203060905ó080209àexon0802pep###

rm genewise2blat.psl middle.out.tab middle.out.tab.all.exon temp.pl

07ú06070107000208°°×01090308×07080303ù06ò×é070309ù0908070708020603090802030001
open(fil,"../pep_genewise/pep.dna.pos");
while(<fil>){
    chomp;split;
    $chr{$_[0]}=$_[1];
    $start{$_[0]}=$_[3];
    $end{$_[0]}=$_[4];}
open(fil,"genewise2blat.psl.all.exon");
while(<fil>){
    chomp;split;
    $start=$start{$_[13]}-1;
    @starts=split(/,/,$_[-2]);
    @ends=split(/,/,$_[-1]);
    print "$_[13]\t$chr{$_[13]}\t";
    for ($i=0;$i<@starts;$i++) {
        $mod_start=$starts[$i]+$start; 
        $mod_end=$ends[$i]+$start;
        print "$mod_start\t$mod_end\t";
    }
    print "\n";
}
perl temp.pl > genewise2blat.psl.all.exon.pos   ###08070103080204ò0904080509à0002exon080208°°×080201070002exon080204080001020300010403030405010909040808°°×0707020508050704retro04010902050206050802pep0501070702050805chimeric03ù06ò###
rm temp.pl

2, 0906080501090308×070705×0703ù06ò0001080690bp04°06080703080208°°×05010003±050900×ó05à05¨00ù0606020300010403030404040900×ó05à09à0602080206¤090605010707±à000504ò090400á0603×ó05à04ò0904050803ò070605à04ò0904      ###00ú×00060905ó0802pep070702050805chimeric0802###
open(fil1,"../express/blat2/output.psl.best");
open(fil2,"genewise2blat.psl.all.exon.pos");
open(fil3,">>pep.minus.overlap.retro.pos.left");
open(fil4,">>pep.minus.overlap.retro.pos.right");
@retros=<fil1>;
@peps=<fil2>;
for $retro(@retros){
    chomp $retro;
    @retro_pos=split(/\s+/,$retro);
    for $pep(@peps){
       open(file1,">left");
       open(file2,">right");
       chomp $pep;
       @pep_pos=split(/\s+/,$pep);
       if($retro_pos[13] eq $pep_pos[1]){
            undef $length;
            for ($i=2;$i<$#pep_pos;$i+=2){
                 if($pep_pos[$i+1]<=$retro_pos[15]){
                      print file1 "$retro_pos[9]\t$pep_pos[0]\t$pep_pos[1]\t$pep_pos[$i]\t$pep_pos[$i+1]\n";}
                 elsif($pep_pos[$i]<=$retro_pos[15]&&$pep_pos[$i+1]>=$retro_pos[15]&&$pep_pos[$i+1]<=$retro_pos[16]){
                      print file1 "$retro_pos[9]\t$pep_pos[0]\t$pep_pos[1]\t$pep_pos[$i]\t$retro_pos[15]\n";
                      $temp_length=$pep_pos[$i+1]-$retro_pos[15]+1;}
                 elsif($pep_pos[$i]<=$retro_pos[15]&&$pep_pos[$i+1]>=$retro_pos[16]){
                      print file1 "$retro_pos[9]\t$pep_pos[0]\t$pep_pos[1]\t$pep_pos[$i]\t$retro_pos[15]\n";
                      print file2 "$retro_pos[9]\t$pep_pos[0]\t$pep_pos[1]\t$retro_pos[16]\t$pep_pos[$i+1]\n";
                      $temp_length=$retro_pos[16]-$retro_pos[15]+1;}
                 elsif($pep_pos[$i]>=$retro_pos[15]&&$pep_pos[$i+1]<=$retro_pos[16]){
                      $temp_length=$pep_pos[$i+1]-$pep_pos[$i]+1;}
                 elsif($pep_pos[$i]>=$retro_pos[15]&&$pep_pos[$i]<$retro_pos[16]&&$pep_pos[$i+1]>=$retro_pos[16]){
                      print file2 "$retro_pos[9]\t$pep_pos[0]\t$pep_pos[1]\t$retro_pos[16]\t$pep_pos[$i+1]\n";
                      $temp_length=$retro_pos[16]-$pep_pos[$i];}
                 elsif($pep_pos[$i]>=$retro_pos[16]){
                      print file2 "$retro_pos[9]\t$pep_pos[0]\t$pep_pos[1]\t$pep_pos[$i]\t$pep_pos[$i+1]\n";}
            $length+=$temp_length;
            undef $temp_length;}
        }
        if($length>=90){
            open(file1,"left")||die "$!";
            while(<file1>){
               print fil3;
            }
            open(file2,"right");
            while(<file2>){
               print fil4;
            }
        }
     }
}
nohup perl temp.pl &
rm temp.pl left right nohup.out

3050104070605000003ù06ò080201040604050107030300050707ì000003ù06ò1wbp   ###020204060004090604ò0502000003ù06ò010406040501×0703ù06ò0104060405010705×0703ù06ò0001080608°°×05010203000104030304###
open(fil,"../check/par_son.txt");
while(<fil>){
     chomp;split;
     $par{$_[1]}=$_[0];}
open(fil,"../pep_genewise/middle.out.tab.multi.exon.best.and.uniq");
while(<fil>){
     chomp;split;
     $dna{$_[0]}=$_[1];}
open(fil,"$ARGV[0]");
while(<fil>){
     chomp;split;
     $par=$par{$_[0]};
     $dna=$dna{$par};
     print "$dna\t$_\n";}
perl temp.pl pep.minus.overlap.retro.pos.left> par.pep.minus.overlap.retro.pos.left
perl temp.pl pep.minus.overlap.retro.pos.right> par.pep.minus.overlap.retro.pos.right

00á0603000003ù06ò04°070303001wbp04ò0904
open(fil,"$ARGV[0]");
while(<fil>){
    chomp;split;
    $flag{$_[0]}=1;}
open(fil,"../pep_genewise/pep.dna.pos");
while(<fil>){
    chomp;split;
    if($flag{$_[0]}){
    $start=$_[-2]-10000;
    $end=$_[-1]+10000;
    print "$_[0]\t$_[1]\t$_[2]\t$start\t$end\n";}
}
perl temp.pl par.pep.minus.overlap.retro.pos.left> par.overlap.flanking.pos.left
perl temp.pl par.pep.minus.overlap.retro.pos.right> par.overlap.flanking.pos.right

00á0603000003ù06ò04°050707ì04ò0904
perl ~/yangliandong/bin/get_fa_from_genome.lixin.pl -p par.overlap.flanking.pos.left -s ../Oryzias_latipes.MEDAKA1.62.dna_rm.toplevel.fa -o par.overlap.flanking.pos.seq.left
perl ~/yangliandong/bin/get_fa_from_genome.lixin.pl -p par.overlap.flanking.pos.right -s ../Oryzias_latipes.MEDAKA1.62.dna_rm.toplevel.fa -o par.overlap.flanking.pos.seq.right

4050100ù06060705retro07040001080608°°××ó070609à0602080206¤09060003020105010909000206¤0906060506010805±à00050503×ó07060905090909à0602080206¤0906050100á0603000108°°××ó07060905090909à0602080204ò090405¨060608000909retro04ò09040508
open(fil,"$ARGV[0]");
while(<fil>){
   chomp;split;
   $temp=$_[4]-$_[3]+1;
   $left_length{$_[1]}+=$temp;}
while(($key,$value)=each %left_length){
   if($value>50){
   print "$key\t$value\n";}
  }
perl temp.pl pep.minus.overlap.retro.pos.left > chimeric.coding.pos.left  (00÷09040201060205020705retro07040001080608°°×08020104×00050100010806080206¤0906)
perl temp.pl pep.minus.overlap.retro.pos.right > chimeric.coding.pos.right

×ó±080502
open(fil,"../pep_genewise/multiple_sequence.out");
while(<fil>){
   s/-//g;chomp;split;
   $seq{$_[0]}=$_[1];}
open(fil,"chimeric.coding.pos.left");
while(<fil>){
   chomp;split;
   $leng=$_[1]-1;
   $seq=$seq{$_[0]};
   $left_seq=substr($seq,0,$leng);
   print ">$_[0]\n$left_seq\n";
}
perl temp.pl > chimeric.coding.left.seq

0706±080502
open(fil,"../pep_genewise/multiple_sequence.out");
while(<fil>){
   s/-//g;chomp;split;
   $seq{$_[0]}=$_[1];}
open(fil,"chimeric.coding.pos.right");
while(<fil>){
   chomp;split;
   $leng=$_[1]*(-1);
   $seq=$seq{$_[0]};
   $right_seq=substr($seq,$leng,$_[1]);
   print ">$_[0]\n$right_seq\n";
}
perl temp.pl > chimeric.coding.right.seq


=======================================×060400=================================================
010107030509020303ù06ò0802040309¨050108020807080209÷0600070702050704080002080009050106010805×ó±0807050706±08×02blast080208±02ò0501070702050707000108050509020303ù06ò0802×ó±080908000003ù06ò0802×ó07060905±0805010509020303ù06ò08020706±0806à080506040709
06ò07090501°050509020303ù06ò×ó07060905±0809010507040808070501000404010701060000070002X000007090501060302ó×02blast
09010507
open(IN,"chimeric.coding.left.seq");
while(<IN>){
   if(/>/){
     s/[>\s]//g;
     $name = $_;}else{
     s/\s//g;
     $left{$name} .= $_;}
     }
open(IN,"chimeric.coding.right.seq");
while(<IN>){
   if(/>/){
     s/[>\s]//g;
     $name = $_;}else{
     s/\s//g;
     $right{$name} .= $_;}
     }
$temp_seq =  'X' x 1000;
foreach (keys %left){$flag{$_}++;}
foreach (keys %right){$flag{$_}++;}
foreach (keys %flag){
    $left_seq = '';
    $right_seq = '';
    $left_seq = $left{$_};
    $right_seq = $right{$_};
    print ">$_\n$left_seq$temp_seq$right_seq\n";
    }
perl temp.pl > left_right_connected.seq 

00ù060607090901050704ò090400á06030602090807070802×0703ù06ò0501000003ù06ò0501060804°0509020303ù06ò
open fil1, "par.pep.minus.overlap.retro.pos.left";
while (<fil1>) {
    chomp;split;
    $line{$_[2]} = $_;
}
open fil2, "par.pep.minus.overlap.retro.pos.right";
while (<fil2>) {
    chomp;split;
    $line{$_[2]} = $_;
}
open fil3, "left_right_connected.seq";
while (<fil3>) {
    chomp;
    if (/>/) {
        s/>//;
        print "$line{$_}\n";
    }
}
perl temp.pl > par.retro.chimeric 05¨020204060004090604ò0502000003ù06ò010406040501×0703ù06ò0104060405010509020303ù06ò010406040508

00á0603000003ù06ò04°070303001wbp04ò0904
open(fil,"par.retro.chimeric");
while(<fil>){
    chomp;split;
    $flag{$_[0]}=1;}
open(fil1,"../pep_genewise/pep.dna.pos");
while(<fil1>){
    chomp;split;
    if($flag{$_[0]}){
    $start=$_[-2]-10000;
    $end=$_[-1]+10000;
    print "$_[0]\t$_[1]\t$_[2]\t$start\t$end\n";}
}
perl temp.pl  > par.pos (07070205070404000002×0703ù06ò010503í06030002000003ù06ò050109ù0608par.pos0807010300030704126000205010903par.retro.chimeric07042100002)

00á0603000003ù06ò04°050707ì04ò0904
perl ~/yangld/bin/get_fa_from_genome.lixin.pl -p par.pos -s ../Danio_rerio.Zv9.67.dna_rm.toplevel.fa -o par.pos.seq

0701×0703ù06ò0905±0804ò09040901050702ó080204ò0904090803à0707×0703ù06ò0802000003ù06ò×02tblastx0502
open(fil,"par.pos.seq");    
while(<fil>){
   chomp;
   if(/>/){
      s/>//;
      $name=$_;
   }else{
      $seq1{$name}.=$_;}
}
open(fil,"left_right_connected.seq");     
while(<fil>) {
   chomp;
   if(/>/){
      s/>//;
      $name=$_;
   }else{
      $seq2{$name}.=$_;}
}
open(fil,"par.retro.chimeric");
while(<fil>){
   chomp;split;
   if($seq2{$_[2]}){
      open(fil1,">par");
      open(fil2,">chimeric");
      print fil1 ">$_[0]\n$seq1{$_[0]}\n";
      print fil2 ">$_[2]\n$seq2{$_[2]}\n";
      `formatdb -i par -p F`;
      `blastall -p tblastx -i chimeric -d par -e 0.1 -F F -m 8 -o blast/"$_[2]".bla.out`;
   }
}
mkdir blast
nohup perl temp.pl &

0103070406020202hit0802070309¨04070209chimeric03ù06ò
ll > temp
more temp |awk {'if($5<1)print'}|awk {'print $9'}|perl -e {'while(<>){chomp;s/\.bla\.out//;print "$_\n"}'}> ../chimeric.last 05¨×060009080205á010413100020509020303ù06ò,06・0808080502¨060308020104×000508
cd ..

00á06030602000003ù06ò0501×0703ù06ò05010509020303ù06ò0802±à02030502
(06ò0209090601090308×070705×0703ù06ò0001080690bp04°06080703080208°°×0805070108°°×080709060802050109ù0608070702050400000208°°×000308050603000203ù06ò05ú07ú080206ì010100020501
09ù0608×0703ù06ò0802000008à000307041120002050109030509020308°°×080208050207070413100020503010108í050106030002000003ù06ò070705ú07ú09à0002×0703ù06ò050109ù0608000003ù06ò0802
0805020705020209800002)
open(fil,"chimeric.last");
while(<fil>){
    chomp;
    $flag{$_}=1;
}
open(fil1,"par.retro.chimeric");
while(<fil1>){
    chomp;split;
    if ($flag{$_[2]}){
        print "$_[0]\t$_[1]\t$_[2]\n";}
}
perl temp.pl  > par.retro.chimeric.last.information 05¨02020406000409060804060807020805000003ù06ò0501×0703ù06ò05010509020303ù06ò0802010406040508

07ú06073000008à040103ù06ò00÷×080802gtf020204060502
mkdir gtf.information
08030709020204060404/export/home/clad/zzx/gtf.information0004080904040502

050008°°×0802ID×090303020909080707080203ù06ò0802ID0502
open fil, "../Danio_rerio.Zv9.67.pep.all.fa";
while (<fil>) {
    chomp;
    if (/>/) {
        (my $gene_id) = ($_=~/gene:(ENS.*) transcript:/);
        s/>//;split;
        $gene_name{$_[0]} = $gene_id;
    }
}
open fil1, "par.retro.chimeric.last.information";
while (<fil1>) {
    chomp;split;
    print "$gene_name{$_[0]}\t$_[1]\t$gene_name{$_[2]}\n";
}
perl temp.pl > par.retro.chimeric.last.information.mod (06050602050008°°×0802ID±010607090909080707080203ù06òID05010509020303ù06ò080208050207020911200020501×0703ù06ò0605020911200020501000003ù06ò0209800002)

08°°×ID±01020903ù06òID02ó050103á0602030000010007050106ò070905010609060600010007050205¨06060001000702ó08020509020303ù06ò0802080502070003070411200020508
open fil, "par.retro.chimeric.last.information.mod";
while (<fil>) {
    chomp;
    $num{$_}++;
}
for (sort keys %num) {
    print "$_\n";
}
perl temp.pl > par.retro.chimeric.last.information.mod.last (06060001000702ó080205á0104)

000003ù06ò02010509020303ù06ò0802gtf020204060502
open fil1, "par.retro.chimeric.last.information.mod";
while (<fil1>) {
    chomp;split;
    $par_names.=$_[0];
    $chimeric_names.=$_[2];
}
open fil2 ,"Danio_rerio.Zv9.64.gtf";
while (<fil2>) {
    chomp;
    open file1, ">>par.gtf";
    open file2, ">>chimeric.gtf";
    @te=split /"/, $_;
    if ($par_names=~/$te[1]/) {
        print file1 "$_\n";
    }
    if ($chimeric_names=~/$te[1]/) {
        print file2 "$_\n";
    }
}
nohup perl temp.pl &

00á06030602×0703ù06ò0802・0503ò04030304
open fil, "Danio_rerio.Zv9.64.gtf";
while (<fil>) {
    chomp;s/"/\t/g;split;
    if ($_[2] eq "exon") {
        $direction{$_[9]} = $_[6];
    }
} 
open fil1, "par.retro.chimeric.last.information.mod.last";
while (<fil1>) {
    chomp;split;
    print "$_[0]\t$_[1]_$direction{$_[2]}\t$_[2]\n";
}
perl temp.pl > par.retro.chimeric.last.information.mod.last.mod 0202040600040704×0703ù06ò0802・0503ò

×0703ù06ò0802gtf020204060502********05§01ò08±0402×0703ù06ò08020104×00080701030503080500030704509040802020500000501070706080800090404070002************
open fil, "par.retro.chimeric.last.information.mod.last.mod";
while (<fil>) {
    chomp;split;
    @in = split /_/, $_[1];
    my $retro = "$in[0]_$in[1]_$in[2]_$in[3]";
    $chr{$retro}=$in[1];
    $start{$retro}=$in[2];
    $end{$retro}=$in[3];
    $direction{$retro}=$in[4];
}
for (sort keys %chr) {
    print "$chr{$_}\tprotein_coding\texon\t$start{$_}\t$end{$_}\t\.\t$direction{$_}\t\.\tgene_id \"$_\"\n";
}
perl temp.pl > retro.gtf

00á0603060201030704040206070509020303ù06ò080202050507・00retro040109020502
open fil, "par.retro.chimeric.last.information.mod.last";
while (<fil>) {
    chomp;split;
    $names.=$_[1];
}
open fil1,"par_son.txt";
while (<fil1>) {
    chomp;split;
    unless ($names=~/$_[1]/) {
        print "$_\n";
    }
}
perl temp.pl > retro.not.chimeric 01030704040206070509020303ù06ò0802retro04010902

07ú060709090408040109020802gtf02020406050206ò020901030704040206070509020303ù06ò050109ù0608050300090808retro040109020802・0503ò04030304050109ù06080905000209070904×02060303000502
open fil, "retro.not.chimeric";
while (<fil>) {
    chomp;split;
    my @in = split /_/, $_[1];
    if (@in == 4) {
        $chr{$_[1]}=$in[1];
        $start{$_[1]}=$in[2];
        $end{$_[1]}=$in[3];
    }elsif (@in == 5) {
        $chr{$_[1]}=$in[1]._.$in[2];
        $start{$_[1]}=$in[3];
        $end{$_[1]}=$in[4];
    }
}
for (sort keys %chr) {
    print "$chr{$_}\tprotein_coding\texon\t$start{$_}\t$end{$_}\t\.\t+\t\.\tgene_id \"$_\";\n";
}
perl temp.pl > retro.not.chimeric.gtf




===============================================================================================
09à06020807080204ò09040705000003ù06ò04°050707ì04ò0904×02tblastx
cat par.pep.minus.overlap.retro.pos.left par.pep.minus.overlap.retro.pos.right |awk {'print ""$1"\t"$2"\t"$3""'}|sort -u > temp3

×02tblastx05020608030001ü0906×ó070600÷0007040406030702
open(fil,"par.overlap.flanking.pos.seq.left");    ###par.overlap.flanking.pos.seq.left080701030805000003ù06ò04°070303000702050707ì1wbp080204ò0904###
while(<fil>){
   chomp;
   if(/>/){
      s/>//;
      $name=$_;
   }else{
      $seq1{$name}.=$_;}
}
open(fil,"chimeric.coding.left.seq");     ###0705retro070400010806080208°°×0800080506060800retro080204ò0904###
while(<fil>) {
   chomp;
   if(/>/){
      s/>//;
      $name=$_;
   }else{
      $seq2{$name}.=$_;}
}
open(fil,"temp3");
while(<fil>){
   chomp;split;
   if($seq2{$_[2]}){
      open(fil1,">par");
      open(fil2,">chimeric");
      print fil1 ">$_[0]\n$seq1{$_[0]}\n";
      print fil2 ">$_[2]\n$seq2{$_[2]}\n";
      `formatdb -i par -p F`;
      `blastall -p tblastx -i chimeric -d par -e 0.1 -F F -m 8 -o blast/"$_[2]".bla.out`;
   }
}
mkdir blast
nohup perl temp.pl &

0106040401070002pep0802±à00050503060608000705retro0802overlap02ó08050300080206¤09060501060804°0705000008°°×04°050707ì04ò0904±06090807030802×06×ó09090201×0607060909
060401040805030006¤090607ó070350bp050108ò060302090904080506030002chimeric gene
cd blast/
open(fil,"../chimeric.coding.left.seq");
while(<fil>){
   chomp;
   if(/>/){
      s/>//;
      $name=$_;
   }else{
      $seq{$name}.=$_;
   }
}
for $name (keys %seq){
    $length='';$min=100000000000;$max='';$seq='';@_='';
    $seq=$seq{$name};
    $length=length($seq);
    open(fil,"$name.bla.out");
    while(<fil>){
    chomp;split;
    if($_[6]<$min){
       $min=$_[6];}
    if($_[7]<$min){
    $min=$_[7];}
    if($_[6]>$max){
    $max=$_[6];}
    if($_[7]>$max){
    $max=$_[7];}
     }
    if($_[0]){print "$_[0]\t$_[1]\t$length\t$min\t$max\n";}
  }
perl temp.pl > chimeric.temp

×ó0909080006¤09060601010550bp04070209chimeric
more chimeric.temp|awk {'if($4>50)print'} > ../chimeric1.left

07060909080006¤09060601010550bp04070209chimeric
more chimeric.temp|awk {'if($3-$5>50)print'} > ../chimeric1.right

0103070406020202hit080206050209chimeric
ll > temp
more temp |awk {'if($5<1)print'}|awk {'print $9'}|perl -e {'while(<>){chomp;s/\.bla\.out//;print "$_\n"}'}>../chimeric2.left
cd ..

040700020603040800090805
open(fil,"chimeric2.left");
while(<fil>){
   chomp;
   $flag{$_}=1;}
open(fil,"temp3");
while(<fil>){
   chomp;split;
   if($flag{$_[2]}){
   print "$_[0]\t$_[1]\t$_[2]\n";}
  }
perl temp.pl  > temp
mv temp chimeric2.left

open(fil,"chimeric1.left");
while(<fil>){
   chomp;split;
   $flag{$_[0]}=1;
   $pep{$_[0]}=$_[1];
   $len{$_[0]}=$_[2];
   $start{$_[0]}=$_[3];
   $end{$_[0]}=$_[4];}
open(fil,"temp3");
while(<fil>){
   chomp;split;
   if($flag{$_[2]}){
   print "$_[0]\t$_[1]\t$_[2]\t$len{$_[2]}\t$start{$_[2]}\t$end{$_[2]}\n";}}
perl temp.pl > temp
mv temp chimeric1.left
rm -rf nohup.out formatdb.log par.n* par temp.pl  blast

0203050409ù070405á010405010801080509ù07040802chimericgene
more chimeric1.left|awk {'print $3'} > temp1
more chimeric2.left|awk {'print $3'} > temp2
more chimeric2.right|awk {'print $3'} > temp3   ###chimeric2.right01030704090608050909000202020406###
more chimeric1.right|awk {'print $3'} > temp4
cat temp1 temp2 temp3 temp4 > temp
more temp|sort -u > chimeric 05¨0400080203080603340002chimericgene0508  °0800í0700070415400020509020303ù06ò
rm temp* 


************************************************************************************************************************
                                               chiemric0705retrocopy080201010308
************************************************************************************************************************
06040104000003ù06ò090908§2000203ò0608070302030201×07050108ò±06050306・09¨080506030002retrocopy050100á0603000003ù06ò×0703ù06ò080204ò0904・03080306030408±000703±060503
open(fil,"../check/par_son.txt");
while(<fil>){
   undef $count;
   $count=tr/://;
   if($count>1){
   chomp;split;
   $count{$_[2]}++;}
  }
open(fil,"../fasta/genewise/multiple_sequence.out");
while(<fil>){
    s/-//g;chomp;split;
    $seq{$_[0]}=$_[1];}
open(fil,"../solar/genewise/multiple_sequence.out");
while(<fil>){
    s/-//g;chomp;split;
    $seq{$_[0]}=$_[1];}
open(fil,"$ARGV[0]");
while(<fil>){
    chomp;split;
    if($count{$_[1]}){
    $retro_seq=$seq{$_[1]};
    $chimeric_seq=$seq{$_[2]};
    print ">$_[2]\n$chimeric_seq\n";
    print ">$_[1]\n$retro_seq\n";
    print "//\n";}
  }
perl temp.pl chimeric2.left > chimeric2.left.seqpair
perl temp.pl chimeric2.right > chimeric2.right.seqpair
cluatalw0908020306ì0605080204ò0904070702050805blat09¨020302080009050107060605
09í01090501WB_Cjaponica0807T8690_C14C6.20201WB_Cbriggsae08070802T27819_CRE270370607090409050702retro
      WB_Cbrenneri0807T17433_CJA188110201T8081_CJA08755±0607í0805chimeric05010700±03retro


************************************************************************************************************************
                                             chimericgene080205030304
00±0308010108070701ortholuge-RBB.pl040309¨05¨/home/zouming/Cjaponica/Ortho0508
nohup ortholuge-RBB.pl -1 Cbriggsae -2 Cbrenneri -o rbb -w . -t protein
************************************************************************************************************************
mkdir chimeric_kaks
cd chimeric_kaks/
050000±03080101080701010308copy080508±05°020204060404
ls ../../../Ortho/|awk {'print "cp ../../../Ortho/"$1"/rbb "$1".rbb"'}|grep "Cbriggsae_"|sh
0500middle.out.tab02020406copy080508±05°020204060404
ls ../../../|awk {'print "cp ../../../"$1"/solar/genewise/middle.out.tab "$1".middle.out.tab"'}|grep "WB_C"|sh
±050900identity07ó070398%0501overlap07ó070370%0501050601030704frameshift0201stopcodon080204ò090405010909040808°°×070700010805070503ù06ò×é04ò0904±060908090402010506070409à000201090308×070802
more WB_Celegants.middle.out.tab |awk {'if($5>98 && $6>70 && $8<1 && $9<1)print'} > WB_Celegants.middle.out.tab.good
more WB_Celegants.middle.out.tab |awk {'if($5>98 && $6>70 && $8<1 && $9<1)print'} > WB_Celegants.middle.out.tab.good
more WB_Cjaponica.middle.out.tab |awk {'if($5>98 && $6>70 && $8<1 && $9<1)print'} > WB_Cjaponica.middle.out.tab.good
more WB_Cbrenneri.middle.out.tab |awk {'if($5>98 && $6>70 && $8<1 && $9<1)print'} > WB_Cbrenneri.middle.out.tab.good
more WB_Cbriggsae.middle.out.tab |awk {'if($5>98 && $6>70 && $8<1 && $9<1)print'} > WB_Cbriggsae.middle.out.tab.good
06060001000705010503080904060301AA×0609à080202¨0603region
open(fil,"$ARGV[0]");
while(<fil>){
     chomp;split;
     $cutoff=$_[4]*$_[5];
     if($cutoff>$hash{$_[0]}){
           $hash{$_[0]}=$cutoff;}
}
open(fil,"$ARGV[0]");
while(<fil>){
     chomp;split;
     $cutoff=$_[4]*$_[5];
     if(($count{$_[0]}<1)&&($hash{$_[0]}==$cutoff)){
            print "$_\n";
            $count{$_[0]}++;}
}
ls *.out.tab.good|awk {'print "perl temp.pl "$1" > "$1".uniq"'}|sh
rm temp.pl
00á06030705000102070000chimericgene00±030801010807080204010904020700000802gene01040604050105ú07ú06030002±í0009
@names=<*.rbb>;
for $name(@names){
    $count++;
    open(fil,"$name");
    while(<fil>){
    chomp;split;
    $temp_hash_name="hash"."$count";
    $$temp_hash_name{$_[0]}=$_[1];}
  }
for $key(sort keys %hash1){
    print "$key\t";
    if($hash1{$key}){print "$hash1{$key}\t";}else{print "nan\t";}
    if($hash2{$key}){print "$hash2{$key}\t";}else{print "nan\t";}
    if($hash3{$key}){print "$hash3{$key}\t";}else{print "nan\t";}
    if($hash4{$key}){print "$hash4{$key}\n";}else{print "nan\n";}
   }
perl temp.pl > table.rbb
rm temp.pl
°0702070000×000200090604ò03030904±í000908020904
more table.rbb |awk {'print $2"\t"$3"\t"$4"\t"$5"\t"$1'}  >temp
mv temp table.rbb
00ù0606table.rbb00á060300÷000202070000080200±03080101080703ù06ò,05ú07ú0603000204000802±í0009050106080407±ê05080802dna0104×0001ü0104(04è060900020904#0601)
open(fil,"WB_Celegants.middle.out.tab.good.uniq");
while(<fil>){chomp;split;$dna_of_CBN{$_[0]}=$_[1];}
open(fil,"WB_Celegants.middle.out.tab.good.uniq");
while(<fil>){chomp;split;$dna_of_CBG{$_[0]}=$_[1];}
open(fil,"WB_Cjaponica.middle.out.tab.good.uniq");
while(<fil>){chomp;split;$dna_of_ELE{$_[0]}=$_[1];}
open(fil,"WB_Cbrenneri.middle.out.tab.good.uniq");
while(<fil>){chomp;split;$dna_of_CJA{$_[0]}=$_[1];}
#open(fil,"WB_Cbriggsae.middle.out.tab.good.uniq");
#while(<fil>){chomp;split;$dna_of_CRE{$_[0]}=$_[1];}
open(fil,"../chimeric");
while(<fil>){
   chomp;split(/_/,);
   $flag{$_[1]}++;
   $dna_of_CRE{$_[1]}=$_;}   #
open(fil,"table.rbb");
while(<fil>){
    chomp;split;
    if ($flag{$_[4]}){       #
    if ($dna_of_CBN{$_[0]}){print "$dna_of_CBN{$_[0]}\t";}else{print "nan\t";}
    if ($dna_of_CBG{$_[1]}){print "$dna_of_CBG{$_[1]}\t";}else{print "nan\t";}
    if ($dna_of_ELE{$_[2]}){print "$dna_of_ELE{$_[2]}\t";}else{print "nan\t";}
    if ($dna_of_CJA{$_[3]}){print "$dna_of_CJA{$_[3]}\t";}else{print "nan\t";}
    if ($dna_of_CRE{$_[4]}){print "$dna_of_CRE{$_[4]}\n";}else{print "nan\n";}
                           }
          }
perl temp.pl > table.rbb.ortho
rm temp.pl
00ù0606040005ú07ú0802±í0009050100á060308°°×02010209050909á04ò09040501・030605090807070802020204060404
open(fil,"../../pep");
while(<fil>){
    chomp;
    if(/>/){
    s/>//;split;
    $name=$_[0];}else{
    $pep_seq{$name}.=$_;}
 }
open(fil,"../../../WB_Celegants/solar/genewise/dna.pos.seq");
while(<fil>){
    chomp;
    if(/>/){s/>//;$name=$_;}else{$seq_of_CBN{$name}.=$_;}
  }
open(fil,"../../../WB_Celegants/solar/genewise/dna.pos.seq");
while(<fil>){
    chomp;
    if(/>/){s/>//;$name=$_;}else{$seq_of_CBG{$name}.=$_;}
  }
open(fil,"../../../WB_Cjaponica/solar/genewise/dna.pos.seq");
while(<fil>){
    chomp;
    if(/>/){s/>//;$name=$_;}else{$seq_of_ELE{$name}.=$_;}
  }
open(fil,"../../../WB_Cbrenneri/solar/genewise/dna.pos.seq");
while(<fil>){
    chomp;
    if(/>/){s/>//;$name=$_;}else{$seq_of_CJA{$name}.=$_;}
  }
open(fil,"../../../WB_Cbriggsae/solar/genewise/dna.pos.seq");
while(<fil>){
    chomp;
    if(/>/){s/>//;$name=$_;}else{$seq_of_CRE{$name}.=$_;}
  }
open(fil,"table.rbb.ortho");
while(<fil>){
    $pep_seq='';
    $name_of_CBN='';$name_of_CBG='';$name_of_ELE='';$name_of_CJA='';$name_of_CRE='';
    $seq_of_CBN='';$seq_of_CBG='';$seq_of_ELE='';$seq_of_CJA='';$seq_of_CRE='';
    chomp;split;
    $temp_name=$_[4];   #
    `mkdir $temp_name`;
    open(file,">dna");
    #$name_of_CBN=$dna_of_CBN{$_[0]};
    #$name_of_CBG=$dna_of_CBG{$_[1]};
    #$name_of_ELE=$dna_of_ELE{$_[2]};
    #$name_of_CJA=$dna_of_CJA{$_[3]};
    #$name_of_CRE=$dan_of_CRE{$_[4]};
    $seq_of_CBN=$seq_of_CBN{$_[0]};
    $seq_of_CBG=$seq_of_CBG{$_[1]};
    $seq_of_ELE=$seq_of_ELE{$_[2]};
    $seq_of_CJA=$seq_of_CJA{$_[3]};
    $seq_of_CRE=$seq_of_CRE{$_[4]};
    print file ">seq_of_CBN\n$seq_of_CBN\n" if $seq_of_CBN;
    print file ">seq_of_CBG\n$seq_of_CBG\n" if $seq_of_CBG;
    print file ">seq_of_ELE\n$seq_of_ELE\n" if $seq_of_ELE;
    print file ">seq_of_CJA\n$seq_of_CJA\n" if $seq_of_CJA;
    print file ">seq_of_CRE\n$seq_of_CRE\n" if $seq_of_CRE;
    open(pep,">pep");
    ($one,$two)=split(/_/,$temp_name);
    $pep_seq=$pep_seq{$two};
    print pep ">$two\n$pep_seq\n";
    `mv dna $temp_name`;
    `mv pep $temp_name`;
  }
perl temp.pl
rm temp.pl
0701genewise0503040409080203
@names=<T*>;
for $name(@names){
    `cp $name/* .`;
    open(fil,"dna");
    while(<fil>){
    chomp;
    if(/>/){
    s/>//;
    $seq_name=$_;}else{
    $seq{$seq_name}.=$_;}
    }
    for $key (sort keys %seq){
    open(file,">$key");
    open(file2,">>$name.wis");
    undef $seq;
    $seq=$seq{$key};
    print file ">$key\n$seq\n";
    $genewise=`genewise -quiet -genesf -pseudo -both pep $key`;
    print file2 $genewise;
    undef $key;}
    `mv $name.wis $name/dna.wis`;
  }
0701DealGeneWise_both.pl070708í
@names=<T*>;
for $name(@names){
    `cp $name/* .`;
    `perl ~/bin/DealGeneWise_both.pl -i dna.wis -q pep`;
    `mv multiple_sequence.out $name`;}



=======================================================result===========================================================
mkdir result
cd result
00á0603retrocopy0705000008°°×0908020305é0702
open(fil,"../check/par_son.txt");
while(<fil>){
    chomp;split; 
    $flag{$_[2]}++;}
open(fil,"../fasta/genewise/middle.out.tab.single.exon");
while(<fil>){
    chomp;split; 
    if($flag{$_[1]}){
    print "$_\n";}
}
perl temp.pl > middle.out.tab.retro
rm temp.pl
090908§080202030201×0706¤0906
more ../check/par_son.txt |perl -e {'while(<>){chomp;split(/\t+/,);print "$_[-1]\n"}'}|perl -e {'while(<>){s/[:,]/\t/g;chomp;split;for($i=0;$i<@_;$i+=2){$temp=$_[$i+1]-$_[$i];print "$temp\n"}}'} > lost_intron_length_of_retro
09ù070409à01090308×0703ù06ò080202030201×0706¤0906
more  ../solar/genewise/genewise2blat.psl.multi.exon.best.and.uniq|perl -e '{while(<>) {@temp=split;   @start=split(/,/,$temp[20]); @end=split(/,/, $temp[21]);if (@start>1) {print "$temp[13]\t$#start\t" ; foreach ($i=1;$i<@start;$i++) {$j=$i-1; $intron=abs($start[$i]-$end[$j])-1;print "$intron\t"  } print "\n"; undef  @temp;undef @start; undef @end; }} }'   >intron_length 
more intron_length |perl -e {'while(<>){chomp;split;for($i=2;$i<@_;$i++){print "$_[$i]\n"}}'} > intron_length_of_multi_exon_gene
rm intron_length
000003ù06ò0201×0703ù06ò08030606070000020703080202030001
open(fil,"../solar/genewise/middle.out.tab.multi.exon.best.and.uniq");
while(<fil>){
    chomp;split;
    $dna{$_[0]}=$_[1];}
open(fil,"../solar/genewise/dna.pos");
while(<fil>){
    chomp;split;
    $chrom{$_[0]}=$_[1];}
open(fil,"../solar40/gene.pos.for.genewise");
while(<fil>){ 
    chomp;split;
    $chrom{$_[0]}=$_[1];}
open(fil,"middle.out.tab.retro");
while(<fil>){
    chomp;split;
    $par_dna=$dna{$_[0]};
    $par_chrom=$chrom{$par_dna};
    $retro_chrom=$chrom{$_[1]};
    print "$_[0]\t$par_chrom\t$_[1]\t$retro_chrom\n";}
perl temp.pl  > chrom_distribution
rm temp.pl
×0703ù06ò0805・0901010607chimericgene
open(fil,"../chimeric/chimeric1.left");
while(<fil>){
    chomp;split;
    $chimeric{$_[1]}=$_[2];}
open(fil,"../chimeric/chimeric1.right");
while(<fil>){
    chomp;split;
    $chimeric{$_[1]}=$_[2];}
open(fil,"../chimeric/chimeric2.left");
while(<fil>){
    chomp;split;
    $chimeric{$_[1]}=$_[2];}
open(fil,"../chimeric/chimeric2.right");
while(<fil>){
    chomp;split;
    $chimeric{$_[1]}=$_[2];}
open(fil,"middle.out.tab.retro");
while(<fil>){
    chomp;split;
    $temp_chimeric=$chimeric{$_[1]};
    if($temp_chimeric){
    print "$temp_chimeric\n";}else{
    print "-\n";}
}
perl temp.pl
rm temp.pl
090908070704080207040707±0104000504080205010609×040609
0701R×02・05050204ì05é050104ì05é02030201×0706¤090607040103070403080003050606ì
> mydata=read.table("spss")
> wilcox.test(V2 ~ V1, data=mydata)
http://www.r-tutor.com/elementary-statistics/non-parametric-methods/mann-whitney-wilcoxon-test
WB_Cbrenneri 0.05116
WB_Cbriggsae 0.02613
WB_Celegants 0.6923
WB_Cjaponica 3.633e-13
WB_Cremanei  0.1644


========================================================kaks============================================================
mkdir kaks
cd kaks
05¨0904060300020608000003ù06ò×0703ù06ò0104×00090902030408080701ü0104080202020406040405010500000003ù06ò×0703ù06ò060804°08°°×04ò09040908070704080807
open(fil,"../Oryzias_latipes.MEDAKA1.62.pep.all.fa");
while(<fil>){
    chomp;
    if(/>/){
       s/>//;split;
       $name=$_[0];}else{
       $pep_seq{$name}.=$_;
    }
}
open(fil,"../pep_genewise/multiple_sequence.out");
while(<fil>){
    s/-//g;chomp;split;
    $par_seq{$_[0]}=$_[1];}
open(fil,"../fasta/genewise/multiple_sequence.out");
while(<fil>){
    s/-//g;chomp;split;
    $ret_seq{$_[0]}=$_[1];}

open(fil,"../check/par_son.txt");
while(<fil>){
    chomp;split;
    $temp_name="$_[0]"."_"."$_[1]";
    `mkdir $temp_name`;
    open(file1,">$temp_name/par_seq");
    open(file2,">$temp_name/ret_seq");
    open(file3,">$temp_name/pep_seq");
    $temp_par_seq=$par_seq{$_[0]};
    $temp_ret_seq=$ret_seq{$_[1]};
    $temp_pep_seq=$pep_seq{$_[0]};
    print file1 ">$_[0]\n$temp_par_seq\n";
    print file2 ">$_[1]\n$temp_ret_seq\n";
    print file3 ">$_[0]\n$temp_pep_seq\n";
}

perl temp.pl
rm temp.pl

0701genewise0908000003ù06ò0201×0703ù06ò0503040409080203
@names=<*_*>;
for $name(@names){
    $genewise1=`genewise -quiet -genesf -pseudo -both $name/pep_seq $name/par_seq`;
    $genewise2=`genewise -quiet -genesf -pseudo -both $name/pep_seq $name/ret_seq`;
    open(fil,">temp_wise");    ###070907070503020508010701×・0407・04020303°>>03±050106ò0209070908±0504010307040801060208050703030007030501080506060301000308050803020307030004050109ù060800±0507">"060107070608×・0407080506060909###
    print fil $genewise1;
    print fil $genewise2;
    `perl ~/bin/DealGeneWise_both.pl -i temp_wise -q $name/pep_seq`;
    `mv multiple_sequence.out $name`;}     ###genewise080205á010406020105DealGeneWise_both.pl060004ò070708í02ó0501080309ù07ú060708020202040600040501multiple_sequence.out08070103070407030802080501070001020909á0705pep06020105genewise±06090802ó040603010703080204ò0904###

nohup perl temp.pl &
rm *

04040900000003ù06ò×0703ù06ò09080802kaks050106040104070400á05°0009000101050005×0708ò070103°---03±000307ú
@names=<*_*>;
for $name(@names){
    open(fil,"$name/multiple_sequence.out");
    open(file,">nuc");
    @a=<fil>;$a=join('',@a);split(/\s+/,$a);  ###08¤0306070708í060303000501・05±0002ó0403080200á0603$_[1],$_[2],$_[4],$_[6]08060502×÷###
    print file "$_[1]  $_[2]\n";              ###split03á±050900070901・060208020709×000902050105040803000805á0205070708020709×000902050109ù0608070907070805$_[1]0201$_[2]###
    if($_[4]){                                ###09050002if00010406070706010501060108050209090905000009000101050005×07070103°---03±000307ú0802###
       undef $temp_codon,undef $temp_seq;
       for($i=0;$i<length($_[4]);$i+=3){
          $temp_codon=substr($_[4],$i,3);
          if($temp_codon=~/taa/i||$temp_codon=~/tga/i||$temp_codon=~/tag/i){$temp_codon='---';}
          $temp_seq.=$temp_codon;}
    print file "$_[3]  $temp_seq\n";}
    if($_[6]){
       undef $temp_codon,undef $temp_seq;
       for($i=0;$i<length($_[6]);$i+=3){
          $temp_codon=substr($_[6],$i,3);
          if($temp_codon=~/taa/i||$temp_codon=~/tga/i||$temp_codon=~/tag/i){$temp_codon='---';}
          $temp_seq.=$temp_codon;}
    print file "$_[5]  $temp_seq\n";}

    system ("codeml ~/bin/codeml0.ctl");     ###fix_omega=0.5###
    system ("codeml ~/bin/codeml_2.ctl");    ###01030704010009¨omega###
    system ("yn00 ~/bin/yn00.ctl");
    `mv mlc* $name`;
    `mv yn $name`;
 }

0701PAML0004 codeml0802020308000205040104040900090503ò0503080902030800 : M1a, M2a, M7, M8
                060804°runmode=-2(pairwise) 04040900・0000§0802ka0501ks  05¨06ò02090803yn000802090801÷08é00040501We recommend that you use the ML method (runmode=-2,CodonFreq=2 in codeml.ctl) as much as possible even for pairwise sequence comparidon0508
@names=<*_*>;
for $name(@names){
    open(fil,"$name/multiple_sequence.out");
    open(file,">nuc");
    open(F,">tree");
	@a=<fil>;$a=join('',@a); split(/\s+/,$a);
     print file "$_[1]  $_[2]\n";
    if($_[4]){
    undef $temp_codon,undef $temp_seq;
    for($i=0;$i<length($_[4]);$i+=3){
    $temp_codon=substr($_[4],$i,3);
    if($temp_codon=~/taa/i||$temp_codon=~/tga/i||$temp_codon=~/tag/i){$temp_codon='---';}
    $temp_seq.=$temp_codon;}
    print file "$_[3]  $temp_seq\n";}
    if($_[6]){
    undef $temp_codon,undef $temp_seq;
    for($i=0;$i<length($_[6]);$i+=3){
    $temp_codon=substr($_[6],$i,3);
    if($temp_codon=~/taa/i||$temp_codon=~/tga/i||$temp_codon=~/tag/i){$temp_codon='---';}
    $temp_seq.=$temp_codon;}
    print file "$_[5]  $temp_seq\n";}
    print F "($_[3],$_[5]);";

    system ("codeml ~/bin/codeml_1.ctl");
    system ("codeml ~/bin/codeml_2.ctl");
    system ("codeml ~/bin/codeml_7.ctl");
    system ("codeml ~/bin/codeml_8.ctl"); 
    system ("codeml ~/bin/codeml.ctl");    
    system ("yn00 ~/bin/yn00.ctl");
    `mv mlc* $name`;
    `mv yn $name`;
 }

nohup perl temp.pl &
rm *

runmode=-2080205á01040502
#!/usr/bin/perl
@names=<*_*>;
for $name (@names) {
    open fil, "$name/mlc";
    while (<fil>) {
        chomp;
        if (/t=/) {
            s/=/ /g;split;
            print "$name\t$_[-3]\t$_[-1]\t$_[-5]\n";    
        }
    }
}
perl temp.pl > tempPairwise   080701030703・0308020608070208050707pairwise040409000802ka0501ks,ka/ks

open fil, "tempPairwise";
while (<fil>) {
   s/_/\t/;
   chomp;split;
   print "$_[1]\t$_[2]\t$_[3]\t$_[4]\n";
}
perl temp.pl > pairwise  08070103・03080208050707pairwise04040900080201070002×0703ù06ò0802ka, ks,ka/ks


***yn0005á0104
#!/usr/bin/perl
@names=<*_*>;
for $name(@names){
    open(fil,"$name/yn");
    while(<fil>){
       unless(/omega/){
         if(/\+\-/){
            chomp;split;
            print "$name  ";
            print "ka    $_[-6]  ";
            print "ks    $_[-3]  ";
            print "omega $_[-7]\n"; 
             }
         }
    }
 }
perl temp.pl  > tempYn00

vi temp1 °05×0703ù06ò0104×0000ù05030606 
more ../check/par_son.txt | awk {'print $2'} > temp1

open(fil,"tempYn00");
while(<fil>){
    s/_/\t/;     ###070908±070706080607010704060301080506ò020901030704080107010600060004060301050109ù0608000303á00030303080306030002_###
    chomp;split;
    $ka{$_[1]}=$_[3];
    $ks{$_[1]}=$_[5];
    $omega{$_[1]}=$_[-1];}
open(fil,"temp1");
while(<fil>){
    chomp;
    $ka=$ka{$_};
    $ks=$ks{$_};
    $omega=$omega{$_};
    print "$_\t$ka\t$ks\t$omega\n";}
perl temp.pl  > temp2

0002×08070301030802060004ò0501080000ü04ò±00
open fil, "tempYn00";
while (<fil>) {
   s/_/\t/;
   chomp;split;
   print "$_[1]\t$_[3]\t$_[5]\t$_[7]\n";
}
perl temp.pl > yn00  08070103・03080208050707yn0004040900080201070002×0703ù06ò0802ka, ks, ka/ks

rm *

0908070302050401-2   
#!/usr/bin/perl
@names=<*_*>;
for $name(@names){
    $ln1='';$ln2='';$omega='';
    open(fil1,"$name/mlc_2");
    open(fil2,"$name/mlc0");
    while(<fil1>){
        if(/^lnL/){
            s/=/\t/g;chomp;split;
            $ln1=$_[-1];
        }
     #  if(/dN\/dS/){
     #     s/=/\t/g;chomp;split;
     #     for ($i=0;$i<$#_;$i++){if($_[$i]=~/\//) {$j=$i+1;}}
     #     $omega=$_[$j];
        }
     }
     while(<fil2>){
         if(/^lnL/){
             s/=/\t/g;chomp;split;
             $ln2=$_[-1];
         }
     }

     $ln=2*abs($ln1-$ln2);
     print "$name\t$omega\t$ln\n";
     }
perl temp.pl > temp
rm temp.pl

090807030203080002050401M1a, M2a, M7, M8:
#!/usr/bin/perl
@names=<*_*>;
for $name(@names){
    $ln1='';$ln2='';$ln7='';$ln8='';
    open(fil1,"$name/mlc_1");
    open(fil2,"$name/mlc_2");
    open fil3, "$name/mlc_7";
    open fil4, "$name/mlc_8";
    while(<fil1>){
         if(/^lnL/){
            chomp;split;
            $ln1=$_[4];
           }
    }
    while(<fil2>){
         if(/^lnL/){
            chomp;split;
            $ln2=$_[4];
         }
    }
    while (<fil3>) {
	  if (/^lnL/) {
	      chomp;split;
	      $ln7=$_[4];
         }
    }
    while (<fil4>) {
	  if (/^lnL/){
	      chomp;split;
	      $ln8=$_[4];
         }
    }
    $ln2_1=2*abs($ln2-$ln1);
    $ln8_7=2*abs($ln8-$ln7);
    print "$name\t$ln2_1\t$ln8_7\n";
}

perl temp.pl > temp
rm temp.pl

vi temp1  090600ù×0703ù06ò0104×00
open(fil,"temp");
while(<fil>){
  s/_/\t/;chomp;split;
  $hash{$_[1]}=$_[-1];}
open(fil,"temp1");
while(<fil>){
  undef $hash;
  chomp;
  $hash=$hash{$_};
  print "$_\t$hash\n";
}

0002×08070301030802060004ò
open(fil,"temp");
while(<fil>){
    s/_/\t/;chomp;split;
    print "$_[1]\t$_[2]\t$_[3]\n";
}
perl temp.pl > LTR

0500LTR08070103080205á0104020107¨・05±ê×04±í050304040908±0605010707070705á010408050503080503080003
open fil, "LTR";
while (<fil>) {
    chomp;split;
    if ($_[1]>9.2103 | $_[2]>9.2103) {
        print "$_[0]\t**\n";
    } elsif ($_[1]>5.9915 | $_[2]>5.9915) {
        print "$_[0]\t*\n";
    }
}
perl temp.pl > LTR_significant

×04080105020803kaks0202040604040807010300÷000202020406080202030606:
          yn000807010308050701yn000404090006020802ka,ks04°ka/ks
          pairwise0807010308050701pairwise・05・¨0404090006020802ka/ks,ka,ks
          LTR_significant080701030805060201050203080002050401M10501M20501M70501M804ì05090805080208050805090503ò0503080902030800080203ù06ò(05à÷Fretrocopy010507042880002P0008040307030.05,07042460002040307030.010501080609080701M1M204ì050907042420002040307030.010501080609080701M7M804ì050907042430002040307030.010501090801÷090909050908050900×0205040104ì050908050802090503ò050308090203080003ù±06070303à080605010003070450002×ó070605030101)

08020606060509à0002retrocopy0908070710002parent gene080205é0702050107070707020308000205040104ì050905á01040502
open(fil,"temp");
while(<fil>){
    chomp;@a=split /_/, $_;
    $par_name=$a[0];
    $par{$par_name}++;
}
open fil1,"temp";
while (<fil1>) {
    chomp;@b=split /_/, $_;
    unless ($par{$b[0]}>1) {
        print "$_\n";
    }
}
perl temp.pl > one_par_vs_one_retro  #080305à÷F000400030704550002parent gene0201retrocopy080506030603090807070802

open fil, "one_par_vs_one_retro";
while (<fil>) {
    chomp;split;
    if ($_[1]>9.2103 | $_[2]>9.2103) {
        print "$_[0]\t**\n";
    } elsif ($_[1]>5.9915 | $_[2]>5.9915) {
        print "$_[0]\t*\n";
    }
}
perl temp.pl > one_to_one.sig  #00030704400020805030800030802

03ò0908080500±05070908LTR_significant080205á010405030404070708í  (0709・050805050307070404050106ò0209070107090805060605010707020508030601080402020406LTR_significant00040805060306030908070701010308050108000805090908050602010504ì05é010502ó07ú0607080205á01040501070702050603090809à08020101030805010800000307040401000406030002020504ì05090602090503ò05030809)
open(fil,"temp_significant");
while(<fil>){
    chomp;@m=split /_/, $_;
    $par_name=$m[0];
    $par{$par_name}++;
}
open fil1,"temp_significant";
while (<fil1>) {
    chomp;@n=split /_/, $_;
    unless ($par{$n[0]}>1) {
        print "$_\n";
    }
}
perl temp.pl > temp_significant.single.parent 05¨07046000205010800080502070601010508030603070208020805020705010503070707070508

======================================================functions==========================================================
000003ù06ò01070205
more ../check/par_son.txt |awk {'print $2'}  > par.pep
perl ~/bin/filt_seq_by_list.pl ../pep par.pep par.pep.seq
nohup pantherScore.pl -l ~/PANTHER7.0 -D B -V -i par.pep.seq -o par.pep.seq.fun
0509020303ù06ò01070205
more ../chimeric/chimeric|perl -e {'while(<>){chomp;s/_/\t/;split;print "$_[1]\n"}'} > chi.pep
perl ~/bin/filt_seq_by_list.pl ../pep chi.pep chi.pep.seq
nohup pantherScore.pl -l ~/PANTHER7.0 -D B -V -i chi.pep.seq -o chi.pep.seq.fun
00á060307040701040303040501090908070803030008010704/home/zouming/PANTHER7.0_HMM_classifications090900020202040605¨wget ftp://ftp.pantherdb.org/hmm_classifications/current_release/PANTHER7.0_HMM_classifications0508
vi temp 00ù0605×0703ù06ò090807070802000003ù06ò01040604
open(fil,"/home/zouming/PANTHER7.0_HMM_classifications");
while(<fil>){
   chomp;split (/\t+/,);
   $fun{$_[0]}=$_;}
open(fil,"$ARGV[0]");
while(<fil>){
   chomp;split;
   $pan{$_[0]}=$_[1];}
open(fil,"temp");
while(<fil>){
   undef $pan; undef $fun;
   chomp;split;
   $pan=$pan{$_[0]};
   $fun=$fun{$pan};
   print "$_[0]\t$fun\n";}
perl temp.pl par.pep.seq.fun > par.pep.seq.fun.sort
more chi.pep.seq.fun|awk {'print $1'} > temp
perl temp.pl chi.pep.seq.fun > chi.pep.seq.fun.sort
rm temp*
0006±í
WEGO070708í
0604010406030002000003ù06ò070409à0002×0703ù06ò05010003090006030702
more par.pep.seq.fun.sort |sort -u   > par.pep.seq.fun.sort.uniq
open(fil,"par.pep.seq.fun.sort.uniq");
while(<fil>){
   if(/go/i){
   s/#/\t/g;s/;/\t/g;
   chomp;split;
   $temp=$_[0];
   $goterms{$temp}=\@$temp; 
   for $go(@_){
      if($go=~/GO:/){
           push (@$temp,$go);}
               }
     }
  }
while(($key,$value)=each %goterms){
  print "$key\t";
  for $go(@$value){
  print "$go\t";}
  print "\n";
 }
perl temp.pl > par.pep.seq.fun.sort.uniq.wego
rm temp*           
====================================================relationships========================================================
mkdir relationships
cd relationships/
080304010904020700000802RM0202040604040300010305¨03ù06ò×é0802020909á0709
formatdb -i dna.masked -p F
05000001020700000802×0703ù06ò04ò0904070504010904020700000802RM0105080203ù06ò×é×02tblastx
nohup blastall -p tblastx -i ../express/blat2/son.seq -d ../../WB_Celegants/RM/dna.masked -e 0.1 -F F -o WB_Celegants.bla.out
nohup blastall -p tblastx -i ../express/blat2/son.seq -d ../../WB_Cjaponica/RM/dna.masked -e 0.1  -F F -o WB_Cjaponica.bla.out
nohup blastall -p tblastx -i ../express/blat2/son.seq -d ../../WB_Cbrenneri/RM/dna.masked -e 0.1  -F F -o WB_Cbrenneri.bla.out
nohup blastall -p tblastx -i ../express/blat2/son.seq -d ../../WB_Cbriggsae/RM/dna.masked -e 0.1  -F F -o WB_Cbriggsae.bla.out
nohup perl ~/bin/control_process.pl -i b.sh -c ~/bin/config.ini
1,0207000001050704retrocopy
solar070708í
ls *.bla.out|awk {'print "solar.pl -cCn 40 -d 20 "$1" > "$1".solar.cutoff"'}|sh
00á0603±06070308020209050909á08020203000104030304
more WB_Celegants.bla.out.solar.cutoff|awk {'print $1"\t"$6"\t"$5"\t"$8-10000"\t"$9+10000'} > WB_Celegants.bla.out.solar.cutoff.pos
more WB_Cjaponica.bla.out.solar.cutoff|awk {'print $1"\t"$6"\t"$5"\t"$8-10000"\t"$9+10000'} > WB_Cjaponica.bla.out.solar.cutoff.pos
more WB_Cbrenneri.bla.out.solar.cutoff|awk {'print $1"\t"$6"\t"$5"\t"$8-10000"\t"$9+10000'} > WB_Cbrenneri.bla.out.solar.cutoff.pos
more WB_Cbriggsae.bla.out.solar.cutoff|awk {'print $1"\t"$6"\t"$5"\t"$8-10000"\t"$9+10000'} > WB_Cbriggsae.bla.out.solar.cutoff.pos
00á0603±06070308020209050909á04ò0904
perl ~/bin/get_fa_from_genome.zhk.pl -p WB_Celegants.bla.out.solar.cutoff.pos -s ../../WB_Celegants/RM/dna.masked -o WB_Celegants.bla.out.solar.cutoff.pos.seq
perl ~/bin/get_fa_from_genome.zhk.pl -p WB_Cjaponica.bla.out.solar.cutoff.pos -s ../../WB_Cjaponica/RM/dna.masked -o WB_Cjaponica.bla.out.solar.cutoff.pos.seq
perl ~/bin/get_fa_from_genome.zhk.pl -p WB_Cbrenneri.bla.out.solar.cutoff.pos -s ../../WB_Cbrenneri/RM/dna.masked -o WB_Cbrenneri.bla.out.solar.cutoff.pos.seq
perl ~/bin/get_fa_from_genome.zhk.pl -p WB_Cbriggsae.bla.out.solar.cutoff.pos -s ../../WB_Cbriggsae/RM/dna.masked -o WB_Cbriggsae.bla.out.solar.cutoff.pos.seq
00á0603×0703ù06ò0802000008°°×,080008050608×0703ù06ò08020104×0001ü01040501・05±0008090404run_genewise.pl
open(fil,"../pep");
while(<fil>){
    chomp;
    if(/>/){
    s/>//;split;
    $name=$_[0];}else{
    $seq{$name}.=$_;}
 }
open(fil,"../check/par_son.txt");
while(<fil>){
    chomp;split;
    $pep_seq=$seq{$_[1]};
    print ">$_[2]\n$pep_seq\n";}
perl temp.pl  > peptide
rm temp.pl
07ú0607table02020406
more WB_Celegants.bla.out.solar.cutoff.pos.seq|grep ">"|perl -e {'while(<>){s/>//;chomp;split(/_/,);if($_[4]=~/[A-Z]/i){$temp="$_[0]"."_"."$_[1]"."_"."$_[2]"."_"."$_[3]";}else{$temp="$_[0]"."_"."$_[1]"."_"."$_[2]"."_"."$_[3]"."_"."$_[4]";}print "$_\t$temp\n"}'} > WB_Celegants.bla.out.solar.cutoff.table
more WB_Cjaponica.bla.out.solar.cutoff.pos.seq|grep ">"|perl -e {'while(<>){s/>//;chomp;split(/_/,);if($_[4]=~/[A-Z]/i){$temp="$_[0]"."_"."$_[1]"."_"."$_[2]"."_"."$_[3]";}else{$temp="$_[0]"."_"."$_[1]"."_"."$_[2]"."_"."$_[3]"."_"."$_[4]";}print "$_\t$temp\n"}'} > WB_Cjaponica.bla.out.solar.cutoff.table
more WB_Cbrenneri.bla.out.solar.cutoff.pos.seq|grep ">"|perl -e {'while(<>){s/>//;chomp;split(/_/,);if($_[4]=~/[A-Z]/i){$temp="$_[0]"."_"."$_[1]"."_"."$_[2]"."_"."$_[3]";}else{$temp="$_[0]"."_"."$_[1]"."_"."$_[2]"."_"."$_[3]"."_"."$_[4]";}print "$_\t$temp\n"}'} > WB_Cbrenneri.bla.out.solar.cutoff.table
more WB_Cbriggsae.bla.out.solar.cutoff.pos.seq|grep ">"|perl -e {'while(<>){s/>//;chomp;split(/_/,);if($_[4]=~/[A-Z]/i){$temp="$_[0]"."_"."$_[1]"."_"."$_[2]"."_"."$_[3]";}else{$temp="$_[0]"."_"."$_[1]"."_"."$_[2]"."_"."$_[3]"."_"."$_[4]";}print "$_\t$temp\n"}'}  > WB_Cbriggsae.bla.out.solar.cutoff.table
08090404genewise
ls *.solar.cutoff|awk {'print "perl ~/bin/run_genewise.pl "$1".table "$1".pos.seq peptide"'} > wis.sh
nohup perl ~/bin/control_process.pl -i wis.sh -c ~/bin/config.ini
rm nohup.out *.sh *.dna *.pep
05000107000202070000080204030304060409040805090807070802020204060404
mkdir WB_Celegants WB_Cjaponica WB_Cbrenneri WB_Cbriggsae
cd WB_Cjaponica 
nohup perl ~/bin/DealGeneWise_both.pl -i *.wis -q ../peptide
09080703genewise05á010405010503080903à0904040807ó070340%05010103070402030201×070506090908§000907020603000202030201×070501060901¤check0501090605030805080208ò020902070000000106ì0802
090908§000907020603000202030201×07
open(fil,"../../check/par_son.txt");
while(<fil>){
    chomp;split;
    $par{$_[2]}=$_[1];}
open(fil,"genewise2blat.psl");
while(<fil>){
     chomp;split;
     $par=$par{$_[9]};
     for ($i=0;$i<@_;$i++){
     $_[9]=$par;
     print "$_[$i]\t";
     }
     print "\n";
  }
perl temp.pl > temp
perl ~/bin/remove_one_jiang.pl ../../solar/genewise/genewise2blat.psl.multi.exon.best.and.uniq   temp 10 > temp.remove
05060209080601090308×07,03à0904040807ó070340%050106¤090607ó070330AA
rm temp.pl
vi temp.pl
open(fil,"temp.remove");
while(<fil>){
  chomp;split;
  $flag{$_[2]}++;}
open(fil,"middle.out.tab");
while(<fil>){
  chomp;split;
  $exons{$_[1]}=$_[6];
  $length{$_[1]}=$_[3]-$_[2]+1;
  $iden{$_[1]}=$_[4];
  $retro{$_[1]}=$_[0];
  }
while(($key,$value)=each %flag){
  $exons='';$length='';$iden='';$retro='';
  $exons=$exons{$key};
  $length=$length{$key};
  $iden=$iden{$key};
  $retro=$retro{$key};
  if($value && $exons<2 && $iden>40 && $length>30){
     print "$retro\t$key\n";}
  }
perl temp.pl > homologs
rm nohup.out temp*
°05000003ù06ò0104×00040705030606
open(fil,"../../check/par_son.txt");
while(<fil>){
   chomp;split;
   $par{$_[2]}=$_[1];}
open(fil,"homologs");
open(file,">temp");
while(<fil>){
   chomp;split;
   $par=$par{$_[0]};
   print file "$par\t$_[0]\t$_[1]\n";}
`mv temp homologs`;
perl ~/bin/temp.pl
#!/usr/bin/perl
open(fil,"../../solar/genewise/middle.out.tab.multi.exon.best.and.uniq");
while(<fil>){
    chomp;split;
    $dna{$_[0]}=$_[1];
   }
open(fil,"homologs");
open(fil1,"../../solar/genewise/all.wise");
open(fil2,"$ARGV[0]");
@a=<fil1>;@b=<fil2>;
$a=join('',@a);
$b=join('',@b);
@parent=split(/genewise\s+\$Name:\s+wise2\-2\-0\s+\$\s+\(unreleased\s+release\)/,$a);
@retro=split(/genewise\s+\$Name:\s+wise2\-2\-0\s+\$\s+\(unreleased\s+release\)/,$b);
while(<fil>){
  chomp;
  split;
  $temp="$_[0]\_$_[2]";
  `mkdir parentgene_retrogene/$temp`;
  open(ff1,">parentgene_retrogene/$temp/parentgene.wis");
  open(ff2,">parentgene_retrogene/$temp/retrogene.wis");
  for $parent(@parent){
      $flag='';
      @lines=split(/\s+/,$parent);
      for $line(@lines){
      if($line eq $_[0]){
           $flag=1;next;
           }
      if (($flag) && ($line eq $dna{$_[0]})){
           print ff1 $parent;
           last;}
          }
      }
  for $retro(@retro){
    $flag='';
    @lines=split(/\s+/,$retro);
    for $line(@lines){
    if($line eq $_[1]){
           $flag=1;next;
           }
    if (($flag) && ($line eq $_[2])){
           print ff2 $retro;
           last;}
          }
      }
}
mkdir parentgene_retrogene
nohup perl ~/bin/temp.pl WB_*.wis
02090503080308±04010501090908070003check0502060506¤090607ó07035AA08020502060506±08§ (c.brissage and c.elegans07010802080530002AA)
cd parentgene_retrogene
@names=<*_*>;
label:for $name(@names){
    open(fil,"$name/retrogene.wis");
    while(<fil>){
    if(/\-{5,}/ && !/\<\>/ && /\s+\d+\s+/){
      print "$name\n";
      next label;}
     }
  }
perl ~/bin/temp.pl > temp
04è0609060901¤check06060800040205000408
cd ..
open(fil,"parentgene_retrogene/temp");
while(<fil>){
   chomp;
   $flag{$_}++;}
open(fil,"homologs");
while(<fil>){
   chomp;split;
   $temp="$_[0]_$_[-1]";
   if($flag{$temp}){
     print "../$temp\t$_[0]\t$_[1]\t$_[2]\tf\n";}else{
     print "../$temp\t$_[0]\t$_[1]\t$_[2]\tt\n";}
          }
perl ~/bin/temp.pl > homologs.xls     
030008010909check
cd /home/zouming/Celegants/WB_Cbrenneri/relationships
0106040401070002020700000803040109040207000008020004080205é0702
open(fil,"$ARGV[0]");
while(<fil>){
   chomp;split;
   if($_[4] eq 't'){
   $flag{$_[2]}++;}
  }
open(fil,"../check/par_son.txt");
while(<fil>){ 
   chomp;split;
   if($flag{$_[2]}){
      print "$_[2]\t+\n";}else{
      print "$_[2]\t-\n";}
  }
perl ~/bin/temp.pl WB_Celegants.xls > temp
more temp |awk {'print $2'} 
rm temp
more temp |awk {'print $1'}
010507040802chimericgene
cd /home/zouming/Celegants/Ortho
cp /home/zouming/Celegants/WB_Cbrenneri/chimeric/chimeric .
$dir=$ARGV[0];
open(fil,"$dir/rbb");
while(<fil>){
   chomp;split;
   $hash{$_[0]}=$_[1];
  }
open(fil,"chimeric");
while(<fil>){
   chomp;
   split(/\_/,);
   if($hash{$_[1]}){
   print "$_[1]\t+\n";}else{
   print "$_[1]\t-\n";}
  }
perl temp.pl Cbriggsae_Celegants
090908070501010106030002retrocopy0402060709050002chimericgene05010603020908050707±010400050408ì0607050106030904010500±030801010807080205040404
02070000010507040201000106ì0802retro0201chimeric
cd /home/zouming/Celegants
more cremanei.txt|perl -e {'while(<>){unless(/brenneri/||/\-/){print}}'} > cremanei.txt.common
more cremanei.txt|perl -e {'while(<>){unless(/brenneri/||/\+/){print}}'} > cremanei.txt.specific
07030700txt000908050802summary02020406temp.txt
00á0603summary04030304
open(fil,"$ARGV[0]");
while(<fil>){
      chomp;split;
      $flag{$_[0]}++;}
open(fil,"temp.txt");
while(<fil>){
      chomp;split (/\t/,);
      if($flag{$_[6]}){
      print "$_\n";}
   }
perl temp.pl cremanei.txt.common > cremanei.txt.common.xls
perl temp.pl cremanei.txt.specific > cremanei.txt.specific.xls
090606020905000001060609090608050802retrocopy080203à01010507・00 (00ù0606blat2080701030802020300010705040109040207000003à±06)
cd /home/zouming/Celegants/WB_Cbrenneri/express/blat2
open(fil,"$ARGV[0]");
while(<fil>){
   chomp;split;
   if($_[-1] eq 't'){
        $temp = $_[3];
        @temp = split(/\_/,$temp);
        if(($temp[-3] =~ /random/i)||($temp[-3] =~ /Contig/i)){
             $chrom = "$temp[-4]_$temp[-3]";}else{
             $chrom = $temp[-3];}  
             $start = $temp[-2];
             $end   = $temp[-1];
             open(fil2,"output.psl.best");
             @ref = <fil2>;
             for $ref (@ref){
             chomp $ref;
             @refs = split (/\s+/,$ref);
             $ref_chrom = $refs[13];
             $ref_start = $refs[15]+1;
             $ref_end   = $refs[16]+1;
             if($chrom eq $ref_chrom){
                unless(($end < $ref_start)||($start > $ref_end)){
                       print "$refs[9]\n";}
               }
             }
        }
   }
=======================================================retired===========================================================

09080703temp0807080204ò09040501blast06・09¨050206050805・0902030201×0705010504±ê04050502060506±08§
050008°°×04ò0904020109040802±à000504ò0904・03080506030408
open(fil,"../../solar/genewise/middle.out.tab.multi.exon.best.and.uniq");
while(<fil>){
   chomp;split;
   $dna{$_[0]}=$_[1];}
open(fil,"chimeric.pep.seq");
while(<fil>){
   chomp;
   if(/>/){
   s/>//;split;
   $name=$_[0];}else{
   $seq{$name}.=$_;}
  }
open(fil,"../../solar/genewise/multiple_sequence.out");
while(<fil>){
   chomp;split;
   $seq{$_[0]}=$_[1];}
open(fil,"temp");
while(<fil>){
   chomp;
   print ">$_\n$seq{$_}\n";
   $temp_name=$dna{$_};
   print ">$temp_name\n$seq{$temp_name}\n";
   print "//\n";
  }
perl temp.pl > chimeric.for.exp (080601090308×070802×08040205010601)
mkdir functions
cd functions/
00á0603000003ù06ò0802±à000504ò0904
open(fil,"../solar/genewise/multiple_sequence.out");
while(<fil>){
   s/_/\t/;s/-//g;chomp;split; 
   $_[2]=~tr/atcg/ATCG/;
   $seq{$_[1]}=$_[2];}
open(fil,"../check/par_son.txt");
while(<fil>){
   chomp;split;
   $temp_seq=$seq{$_[1]};
   print ">$_[1]\n$temp_seq\n";} 
perl temp.pl  > par.coding.fasta
03000801blast010702050501blast2go,swissprot
more ../check/par_son.txt |awk {'print $2'}|sort -u > temp1
vi temp2
perl ~/bin/minus.pl temp1 temp2 > temp3
perl ~/bin/filt_seq_by_list.pl par.coding.fasta temp3 temp3.fasta
03000801blast010702050501blast2go,swissprot,ncbi

=========================================================================================================================
                                                       the end 
=========================================================================================================================


1, genewise090802030503020108020603°000704060400050103±010501090305030201080208ò08050709・030802090907ò05010805・0909080203020108020805040005ü05ú07ú08020506010307040107020505010903090808020503020108020503080405ú07ú05060704010702050507
   060607090707060804ò08060802010409000704010702050802retrogene

20501retropseudogene02050704070702050805chimeric gene0507

30501000309ù06080503060408à080506ò020903000402060707í02ó0802chimeric03ù06ò05¨k-link EST clustering: evaluating error introduced by chimeric sequences under different degrees of linkage0508

4, check08±・04030007040802retro0807×08010106030002000003ù06ò0802050301010401090205010506080303à05ü08020203000105010306060708050306retro02ó0502060502030201×07


5,02030201×0709040001±010304050102090805010703á090908§0603000203ò0908040000020501060302ó02030201×0707ó04030802±0103040501070401030704070702050805retro02ó05020605 050703à01010203000102030201×0707ó0403±0103040507


60501retro080302030201×07020305070802030003ó


=================================070708íNCBI03000801080205030101・04070508±04030802×090004×é08050606========================================================================================

0803NCBI0802SRA08050606070903000801medaka080205030101・04070508±04030802×090004×é08050606,05030101・04070508±0403080208050606×0602010806090805¨09040202040604040703・03
nohup wget 010300・URL &

0103070303000801SRA Toolkit 0805~/yangliandong/bin/020204060404030005010509050109010501070901¤0608°ü08070103070400÷0000×0903030202040600090805080206í040605010604fastq-dump
tar xvfz <toolkit file>

090809ù07040802.sra05¨03ò.lite.sra05080202040605030404070708í0501070708í0607fastq00090805
cd  /home/clad/yangliandong/medaka/transcriptome/one_day/SRR005778

~/yangliandong/bin/sratoolkit.2.1.7-centos_linux64/fastq-dump  SRR005778.lite.sra   #0407fastq-dump *.sra(*.lite.sra), 070708í08±×06020105030605090807070802020204060404050106ò020907ú06070802fastq0202040603á080301¤×÷020700040300
   

0908×090004×é08050606050304040008090707010004050106060605(filt)0801000809070802reads   #-f±í0806060908010605080202020406 -t060606050008090700080403070330802040603ù -c0003±05090006060800080100080907000802óreads06¤090607ó0703300002040603ù0802  -e Sanger000809070008(04ì05é08050202000000080907000808±05010707reads000408020008090700080801080208050800070302020000000809070008)
                                                  010405ì01070001reads02ó0103040000020801000809070802040603ù0501060302ó0803fastq format0807010304ì05é09090408080100080907040603ù0802ASCII00080805080007030202000000080907000805¨Sanger000809070008 or solexa00080907000805080407 -e 32 or 64
nohup ~/yangliandong/bin/TQSfastq.py -f SRR005778.fastq -t 3 -c 30 -e 33 &

0701bowtie080705¨0709
/home/clad/yangliandong/medaka/transcriptome/one_day/bowtie-0.12.7/bowtie-build Oryzias_latipes.MEDAKA1.62.dna_rm.toplevel.fa medaka &

0701tophat0807±060908 #tophat06í0406090506050809040404è0609bowtie04°SAMtool0905000206í0406
nohup /home/clad/yangliandong/medaka/transcriptome/one_day/tophat-1.3.3.Linux_x86_64/tophat -p 4 --solexa-quals --segment-length 18 ../../../medaka SRR005778.fastq_T3C30E33.trim.fa &
nohup /home/clad/yangliandong/medaka/transcriptome/one_day/tophat-1.3.3.Linux_x86_64/tophat -p 4  -o tophat_test  ../../medaka SRR005778.fastq_T3C30E33.trim.fa &

0803clad@compute-0-0 04040900one_day0802SSR005778
0803clad@compute-0-1 04040900 2_day/SRR005780 04° SRR005781
0803clad@compute-0-2 04040900 two_day/SRR00578204°SRR005783
0803clad@compute-0-3 04040900 3_day/SRR005784 04°SRR005785
0803clad@compute-0-4 04040900 5_day/SRR005786 04°SRR005787
0803clad@compute-0-5 04040900 10_day/SRR005788 04°SRR005789
0803clad@compute-0-6 04040900 14_day/SRR005790 04°SRR005791

0500.BAM00090805080205á010400020209.SAM00090805
samtools index accepted_hits.bam 
samtools view accepted_hits.bam  >accepted_hits.sam
